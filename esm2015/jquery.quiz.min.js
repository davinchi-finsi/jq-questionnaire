/**
 * @license jq-quiz v2.2.0-beta.3
 * (c) 2018 Finsi, Inc.
 */

$.widget("ui.jqQuiz",{NAMESPACE:"jqQuiz",QUERY_HEADER:"[data-jq-quiz-header]",QUERY_WRAPPER:"[data-jq-quiz-wrapper]",QUERY_BODY:"[data-jq-quiz-body]",QUERY_PROPERTIES:"[data-jq-quiz-properties]",QUERY_QUESTIONS:"[data-jq-quiz-questions]",QUERY_QUESTION:"[data-jq-quiz-question]",QUERY_OPTIONS:"[data-jq-quiz-options]",QUERY_OPTION:"[data-jq-quiz-option]",QUERY_ACTION_START:"[data-jq-quiz-start]",QUERY_ACTION_NEXT:"[data-jq-quiz-next]",QUERY_ACTION_PREV:"[data-jq-quiz-prev]",QUERY_ACTION_END:"[data-jq-quiz-end]",QUERY_RENDER_OPTION:"[data-jq-quiz-property]",QUERY_RENDER_RESULT:"[data-jq-quiz-result-item]",QUERY_RESULT:"[data-jq-quiz-result]",QUERY_FEEDBACK:"[data-jq-quiz-feedback]",IS_CORRECT:"isCorrect",ATTR_CURRENT_QUESTION:"data-current-question",ATTR_IS_CORRECT:"data-is-correct",ATTR_POINTS_FOR_SUCCESS:"data-points-for-success",ATTR_FEEDBACK:"data-jq-quiz-feedback",ATTR_POINTS_FOR_FAIL:"data-points-for-fail",ON_QUESTION_HIDE:"jqQuiz:questionHide",ON_QUESTION_HIDDEN:"jqQuiz:questionHidden",ON_QUESTION_SHOW:"jqQuiz:questionShow",ON_QUESTION_SHOWN:"jqQuiz:questionShow",ON_HEADER_HIDE:"jqQuiz:headerHide",ON_HEADER_SHOW:"jqQuiz:headerShow",ON_BODY_HIDE:"jqQuiz:bodyHide",ON_BODY_HIDDEN:"jqQuiz:bodyHidden",ON_BODY_SHOW:"jqQuiz:bodyShow",ON_BODY_SHOWN:"jqQuiz:bodyShown",ON_TRANSITION_END:"jqQuiz:transitionEnd",ON_OPTION_CHANGE:"jqQuiz:questionChange",ON_START:"jqQuiz:start",ON_STARTED:"jqQuiz:started",ON_END:"jqQuiz:end",FEEDBACK_TYPES:{ok:"ok",ko:"ko"},STATES:{off:0,running:1,result:2,review:3},DISABLE_END:{never:0,beforeAnswerAll:1,beforeAnswerAllCorrect:2},options:{classes:{firstQuestion:"jq-quiz--first-question",lastQuestion:"jq-quiz--last-question",lastQuestionToAsk:"jq-quiz--last-question-to-ask",widget:"jq-quiz",questionCorrect:"jq-quiz--correct",questionIncorrect:"jq-quiz--incorrect",selected:"jq-quiz--selected",stateResult:"jq-quiz--result",stateReview:"jq-quiz--review",stateRunning:"jq-quiz--running",multichoice:"jq-quiz--multi-choice",wrapper:"jq-quiz__form",header:"jq-quiz__header",body:"jq-quiz__body",startBtn:"jq-quiz__start",nextBtn:"jq-quiz__next",prevBtn:"jq-quiz__prev",endBtn:"jq-quiz__end",result:"jq-quiz__result",question:"jq-quiz__question",option:"jq-quiz__option",navbar:"jq-quiz__navbar",button:"jq-quiz__action",properties:"jq-quiz__properties",questions:"jq-quiz__questions",title:"jq-quiz__title",disabled:"jq-quiz--disabled",property:"jq-quiz__property",actions:"jq-quiz__actions",action:"jq-quiz__action",statement:"jq-quiz__statement",options:"jq-quiz__options",field:"jq-quiz__option-field",feedback:"jq-quiz__feedback",resultItem:"jq-quiz__result-item",label:"jq-quiz__option-label",propertyName:"jq-quiz__property"},delayOnAutoNext:500,pointsForSuccess:1,pointsForFail:0,cutOffMark:50,immediateFeedback:!1,allowChangeOption:!1,autoGoNext:!0,showCorrection:!0,showResult:!0,multichoice:!1,disableNextUntilSuccess:!1,disableEndActionUntil:0,dialog:{draggable:!1,autoOpen:!0,resizable:!1,modal:!0},randomize:!1,initialQuestion:null,autoStart:!1},_create:function(){this.element.addClass(this.options.classes.widget),this.options.quiz&&0==this.element.children().length&&this.element.html(this._renderTemplate()),this._getElements(),this.element.uniqueId(),this._mapQuestions(),this._questions=this._originalQuestions.slice(""),this._changeState(this.STATES.off),this._assignEvents(),this._renderOptions(),this.options.autoStart&&this.start()},_renderOptions:function(){this._renderVar(this.QUERY_RENDER_OPTION,"jqQuizProperty")},_renderVar:function(t,s,e,i){i=i||this.element,e=e||this.options;let n=i.find(t);for(let t of n){let i,n,o=$(t),a=o.data(s)||"";if(void 0!=a){[a,i]=a.split("?"),a=a.trim(),void 0!=i&&([i,n]=i.split(":"),i.trim(),n.trim());let t=e[a];t=void 0!=t?t:"",void 0!=i&&t?t=i:void 0==n||t||(t=n),o.html(t)}}},_renderTemplate:function(){let t;const s=this.options.quiz;return s&&(t=`\r\n                    <form class="${this.options.classes.wrapper+(s.wrapper&&s.wrapper.cssClass?0+s.wrapper.cssClass:"")}" data-jq-quiz-wrapper>\r\n                        ${this._renderTemplateHeader(s.header)}\r\n                        ${this._renderTemplateBody(s.body)}\r\n                        ${this._renderTemplateResult(s.result)}\r\n                    </form>\r\n                `),t},_renderTemplateHeader:function(t){let s="";return t&&(s=`\r\n                    <div class="${this.options.classes.header+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-header>\r\n                        ${this._renderTemplateHeaderTitle(t.title)}\r\n                        ${this._renderTemplateHeaderDescription(t.description)}\r\n                        ${this._renderTemplateHeaderProperties(t.properties)}\r\n                        ${this._renderTemplateActions(t.actions)}\r\n                    </div>\r\n                `),s},_renderTemplateHeaderTitle:function(t){let s="";return t&&("string"==(typeof t).toLowerCase()&&(t={tag:"h",level:1,content:t}),"h"!=t.tag||t.level||(t.level=1),s=`\r\n                    <${t.tag}${t.level} class="${this.options.classes.title+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-title>\r\n                        ${t.content}\r\n                    </${t.tag}${t.level}>\r\n                `),s},_renderTemplateHeaderDescription:function(t){let s="";return t&&("string"==(typeof t).toLowerCase()&&(t={tag:"p",content:t}),s=`\r\n                    <${t.tag||"p"} class="${this.options.classes.description+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-description>\r\n                        ${t.content}\r\n                    </${t.tag||"p"}>\r\n                `),s},_renderTemplateHeaderProperties:function(t){let s="";if(t){Array.isArray(t)&&(t={tag:"dl",properties:t});let e="";for(let s=0,i=t.properties.length;s<i;s++){let i=t.properties[s];e+=this._renderTemplateHeaderProperty(i)}s=`\r\n                    <${t.tag||"dl"} class="${this.options.classes.properties+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-properties>\r\n                        ${e}\r\n                    </${t.tag||"dl"}>\r\n                `}return s},_renderTemplateHeaderProperty:function(t){let s="";return t&&(s=`\r\n                    <${t.tagName||"dt"} class="${this.options.classes.propertyName+(t.cssClass?0+t.cssClass:"")}">\r\n                        ${t.content}\r\n                    </${t.tagName||"dt"}>\r\n                    <${t.tagName||"dd"} class="${this.options.classes.propertyName+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-property="${t.type}">\r\n                        \r\n                    </${t.tagName||"dd"}>\r\n                `),s},_renderTemplateActions:function(t){let s="";if(t){Array.isArray(t)&&(t={tag:"div",actions:t});let e="";for(let s=0,i=t.actions.length;s<i;s++){let i=t.actions[s];e+=this._renderTemplateAction(i)}s=`\r\n                    <${t.tag||"div"} class="${this.options.classes.actions+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-actions>\r\n                        ${e}\r\n                    </${t.tag||"div"}>\r\n                `}return s},_renderTemplateAction:function(t){let s="";return t&&(s=`\r\n                    <${t.tagName||"button"} class="${this.options.classes.action+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-${t.type}>\r\n                        ${t.content}\r\n                    </${t.tagName||"button"}>\r\n                `),s},_renderTemplateBody:function(t){let s="";return t&&(s=`\r\n                    <${t.tag||"div"} class="${this.options.classes.body+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-body>\r\n                        ${this._renderTemplateBodyQuestions(t.questions)}\r\n                        ${this._renderTemplateActions(t.actions)}\r\n                    </${t.tag||"div"}>\r\n                `),s},_renderTemplateBodyQuestions:function(t){let s="";if(t&&Array.isArray(t)){Array.isArray(t)&&(t={questions:t});let e="";for(let s of t.questions)e+=this._renderTemplateBodyQuestion(s);s=`\r\n                    <${t.tag||"div"} class="${this.options.classes.questions+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-questions>\r\n                        ${e}\r\n                    </${t.tag||"div"}>\r\n                `}return s},_renderTemplateBodyQuestion:function(t){let s="";return t&&(s=`\r\n                    <${t.tag||"fieldset"} class="${this.options.classes.question+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-question>\r\n                        ${this._renderTemplateBodyQuestionStatement(t.content)}\r\n                        ${this._renderTemplateBodyQuestionOptions(t.options)}\r\n                        ${this._renderTemplateBodyQuestionFeedback(t.feedback)}\r\n                    </${t.tag||"fieldset"}>\r\n                `),s},_renderTemplateBodyQuestionStatement:function(t){let s="";return t&&("string"==(typeof t).toLowerCase()&&(t={content:t}),s=`\r\n                    <${t.tag||"legend"} class="${this.options.classes.statement+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-statement>\r\n                        ${t.content}\r\n                    </${t.tag||"legend"}>\r\n                `),s},_renderTemplateBodyQuestionOptions:function(t){let s="";if(t){let e="";Array.isArray(t)&&(t={options:t});for(let s of t.options)e+=this._renderTemplateBodyQuestionOption(s);s=`\r\n                    <${t.tag||"ul"}  class="${this.options.classes.options+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-options>\r\n                        ${e}\r\n                    </${t.tag||"ul"}>\r\n                `}return s},_renderTemplateBodyQuestionOption:function(t){let s="";return t&&(t.label=t.label||{},t.field=t.field||{},s=`\r\n                    <${t.tag||"li"} class="${this.options.classes.option+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-option data-is-correct="${!!t.isCorrect}">\r\n                        <label class="${this.options.classes.label+(t.label.cssClass?0+t.label.cssClass:"")}"\r\n                                ${t.field&&t.field.id?"for="+t.field.id:""}>\r\n                                <span>${t.content}</span>\r\n                                <input ${t.field&&t.field.id?"id="+t.field.id:""}\r\n                                       class="${this.options.classes.field+(t.field.cssClass?0+t.field.cssClass:"")}" \r\n                                       type="${this.options.multichoice?"checkbox":"radio"}"\r\n                                       ${t.field&&t.field.required?"required":""}\r\n                                       ${t.name?"name="+t.name:""}\r\n                                       ${t.value?"value="+t.value:""}\r\n                                />\r\n                                \r\n                        </label>\r\n                        ${this._renderTemplateBodyQuestionFeedback(t.feedback)}  \r\n                    </${t.tag||"li"}>\r\n                `),s},_renderTemplateBodyQuestionFeedback:function(t){let s="";if(t&&Array.isArray(t))for(let e of t)s+=`\r\n                        <${e.tag||"div"}  class="${this.options.classes.feedback+(e.cssClass?0+e.cssClass:"")}" data-jq-quiz-feedback="${e.type}">\r\n                            ${e.content}\r\n                        </${e.tag||"div"}>\r\n                    `;return s},_renderTemplateResult:function(t){let s="";if(t){Array.isArray(t)&&(t={items:t});let e="";for(let s of t.items)e+=this._renderTemplateResultItem(s);s=`\r\n                    <${t.tag||"div"} class="${this.options.classes.result+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-result>\r\n                        ${e}\r\n                    </${t.tag||"div"}>\r\n                `}return s},_renderTemplateResultItem:function(t){let s="";return t&&(s=`\r\n                    <${t.tagName||"dt"} class="${this.options.classes.resultItem+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-result-item-label="${t.type}">\r\n                        ${t.content}\r\n                    </${t.tagName||"dt"}>\r\n                    <${t.tagName||"dd"} class="${this.options.classes.resultItem+(t.cssClass?0+t.cssClass:"")}" data-jq-quiz-result-item="${t.type}">\r\n                        \r\n                    </${t.tagName||"dd"}>\r\n                `),s},_getElements:function(){this._$wrapper=this.element.find(this.QUERY_WRAPPER).addClass(this.options.classes.wrapper),this._$header=this.element.find(this.QUERY_HEADER).addClass(this.options.classes.header),this._$body=this.element.find(this.QUERY_BODY).addClass(this.options.classes.body),this._$body.hide(),this._$properties=this.element.find(this.QUERY_PROPERTIES).addClass(this.options.classes.properties),this._$questionsWrapper=this.element.find(this.QUERY_QUESTIONS).addClass(this.options.classes.questions),this._$questions=this._$questionsWrapper.find(this.QUERY_QUESTION).addClass(this.options.classes.question),this._$questions.hide(),this._$startBtn=this._$wrapper.find(this.QUERY_ACTION_START).addClass(`${this.options.classes.button} ${this.options.classes.startBtn}`),this._$nextBtn=this._$wrapper.find(this.QUERY_ACTION_NEXT).addClass(`${this.options.classes.button} ${this.options.classes.nextBtn}`),this._$prevBtn=this._$wrapper.find(this.QUERY_ACTION_PREV).addClass(`${this.options.classes.button} ${this.options.classes.prevBtn}`),this._$endBtn=this._$wrapper.find(this.QUERY_ACTION_END).addClass(`${this.options.classes.button} ${this.options.classes.endBtn}`),this._$result=this._$wrapper.find(this.QUERY_RESULT).addClass(this.options.classes.result),this._$result.hide()},_mapQuestions:function(){let t=this._$questions.find(this.QUERY_OPTION).find(":checkbox");t.length>0?(t.attr("type","checkbox"),this.options.multichoice=!0,this.element.addClass(this.options.classes.multichoice)):t.attr("type","radio");let s=this._$questions,e=[],i=0;for(let t=0,n=s.length;t<n;t++){let n=$(s[t]),o=this._mapQuestion(n);e.push(o),i+=o.pointsForSuccess}this._originalQuestions=e,this._maxScore=i,this._setOption("maxScore",i)},_mapQuestion:function(t){let s,e=t.find(this.QUERY_OPTIONS),i=e.find(this.QUERY_OPTION),n=i.first().find("input").attr("name"),o=t.data(this.ATTR_POINTS_FOR_SUCCESS),a=t.data(this.ATTR_POINTS_FOR_FAIL),{arr:arr,map:map}=this._mapOptions(i),r=t.find(this.QUERY_FEEDBACK).not(this.QUERY_OPTION+" "+this.QUERY_FEEDBACK);r.hide(),t.removeAttr(this.ATTR_POINTS_FOR_FAIL),t.removeAttr(this.ATTR_POINTS_FOR_SUCCESS),t.uniqueId(),s=t.attr("id"),n=void 0!=n?n:s,i.find("input").attr("name",n);let h={id:s,$element:t,$optionsWrapper:e,$options:i,options:arr,optionsMap:map,pointsForSuccess:void 0!=o?o:this.options.pointsForSuccess,pointsForFail:void 0!=a?a:this.options.pointsForFail};for(let t of r){let s=$(t),e=s.attr(this.ATTR_FEEDBACK);switch(e){case this.FEEDBACK_TYPES.ok:h.$feedbackOk=s;break;case this.FEEDBACK_TYPES.ko:h.$feedbackKo=s;break;default:h.$feedback=s}}return h.$feedbackOk=h.$feedbackOk||h.$feedback||$(null),h.$feedbackKo=h.$feedbackKo||h.$feedback||$(null),h},_mapOptions:function(t){let s=[],e={};for(let i=0,n=t.length;i<n;i++){let n=$(t[i]),o=this._mapOption(n);s.push(o),e[o.id]=i}return{arr:s,map:e}},_mapOption:function(t){let s,e=!!t.data(this.IS_CORRECT),i=t.find(this.QUERY_FEEDBACK);t.removeAttr(this.ATTR_IS_CORRECT),t.uniqueId();let n={id:s=t.attr("id"),$element:t,isCorrect:e};for(let t of i){let s=$(t),e=s.attr(this.ATTR_FEEDBACK);switch(e){case this.FEEDBACK_TYPES.ok:n.$feedbackOk=s;break;case this.FEEDBACK_TYPES.ko:n.$feedbackKo=s;break;default:n.$feedback=s}}return n.$feedbackOk=n.$feedbackOk||n.$feedback||$(null),n.$feedbackKo=n.$feedbackKo||n.$feedback||$(null),i.hide(),n},_assignEvents:function(){this._$startBtn.off(this.NAMESPACE).on(`click.${this.NAMESPACE}`,{instance:this},this._onStartButtonClick),this._$endBtn.off(this.NAMESPACE).on(`click.${this.NAMESPACE}`,{instance:this},this._onEndButtonClick),this._$nextBtn.off(this.NAMESPACE).on(`click.${this.NAMESPACE}`,{instance:this},this._onNextButtonClick),this._$prevBtn.off(this.NAMESPACE).on(`click.${this.NAMESPACE}`,{instance:this},this._onPrevButtonClick),this._$questions.off(this.NAMESPACE).on(`change.${this.NAMESPACE}`,{instance:this},this._onOptionChange)},_onStartButtonClick:function(t){t.preventDefault(),t.data.instance.start()},_onEndButtonClick:function(t){t.preventDefault(),t.data.instance.end()},_onNextButtonClick:function(t){t.preventDefault(),t.data.instance.next()},_onPrevButtonClick:function(t){t.preventDefault(),t.data.instance.prev()},calificate:function(t){let s,e=0,i=this._maxScore,n=t||this._runtime,o=this._questions,a=0,r=0;if(void 0!=this._runtime||void 0!=t){if(1!=this.options.multichoice){let t=this._calificateSingleChoice(n);a=t.nSuccess,r=t.nFails,e=t.score}else{let t=this._calificateMultiChoice(n);a=t.nSuccess,r=t.nFails,e=t.score}(s={maxScore:i,score:e,percentage:100*e/i,questionsSuccess:a,questionsFail:r,questionsNotAttempted:o.length-(a+r)}).success=s.percentage>=this.options.cutOffMark}else console.log("[jqQuiz] WARN: calificate must be used when the quiz is in running or review state or with a specific runtime");return s},_calificateSingleChoice:function(t){let s=0,e=t||this._runtime,i=this._questions,n=0,o=0;for(let a=0,r=i.length;a<r;a++){let r=i[a],h=(e[r.id],this._calificateSingleChoiceQuestion(r.id,t));void 0!=h&&(h?(s+=r.pointsForSuccess,n++):(o++,s>=r.pointsForFail&&(s-=r.pointsForFail)))}return{nSuccess:n,nFails:o,score:s}},_calificateSingleChoiceQuestion:function(t,s){let e,i=s||this._runtime,n=this.getQuestionById(t);if(n){let t=i[n.id];if(t&&t.options.length>0){let s=n.options,i=n.optionsMap,o=t.options[0],a=s[i[o]];e=a.isCorrect,t.isCorrect=e}}return e},_calificateMultiChoiceQuestion:function(t,s){let e,i=s||this._runtime,n=this.getQuestionById(t);if(n){let t=i[n.id];if(t){let s=n.options,i=t.options,o=0,a=0,r=0;for(let t=0,e=s.length;t<e;t++){let n=s[t],h=-1!=i.indexOf(n.id);n.isCorrect?(a++,o+=h?1:0):h&&(r++,t=e)}e=0==r&&o==a,t.isCorrect=e}}return e},_calificateMultiChoice:function(t){let s=0,e=t||this._runtime,i=this._questions,n=0,o=0;for(let a=0,r=i.length;a<r;a++){let r=i[a],h=(e[r.id],this._calificateMultiChoiceQuestion(r.id,t));void 0!=h&&(h?(n++,s+=r.pointsForSuccess):(o++,s>=r.pointsForFail&&(s-=r.pointsForFail)))}return{nSuccess:n,nFails:o,score:s}},_showOptionStatus:function(t,s){let e=this.getQuestionById(t);if(e){let t=this._runtime[e.id],i=e.options[e.optionsMap[s]];if(t&&i){let e=-1!=t.options.indexOf(s);e?i.$element.addClass(i.isCorrect?this.options.classes.questionCorrect:this.options.classes.questionIncorrect):i.$element.addClass(i.isCorrect?this.options.classes.questionIncorrect:"")}else i.$element.addClass(i.isCorrect?this.options.classes.questionIncorrect:"")}},_showQuestionStatus:function(t){let s=this.getQuestionById(t);if(s){let t=this._runtime[s.id];if(t&&void 0!=t.option){let e=s.options;t.isCorrect?s.$element.addClass(this.options.classes.questionCorrect):s.$element.addClass(this.options.classes.questionIncorrect);for(let t of e)t.isCorrect?t.$element.addClass(this.options.classes.questionCorrect):t.$element.addClass(this.options.classes.questionIncorrect)}}},_showOptionFeedback:function(t,s){let e=this.getQuestionById(t);if(e){let t=this._runtime[e.id],i=e.options[e.optionsMap[s]];if(t&&i){let e=-1!=t.options.indexOf(s);e&&(i.isCorrect?(i.$feedbackKo.hide(),i.$feedbackOk.show()):(i.$feedbackOk.hide(),i.$feedbackKo.show()))}}},_showQuestionFeedback:function(t){let s=this.getQuestionById(t);if(s){let e=this._runtime[s.id];if(e&&void 0!=e){let i=this.getOptionById(t,e.options[0]);i.isCorrect?(s.$feedbackKo.hide(),s.$feedbackOk.show()):(s.$feedbackOk.hide(),s.$feedbackKo.show())}}},_disableQuestionOptionsField:function(t){let s=this.getQuestionById(t);if(s)if(this.options.multichoice&&this._state==this.STATES.running){s.$element.find(":checked").attr("disabled","disabled");for(let t of s.options)t.$element.find(":checked").length>0&&t.$element.addClass(this.options.classes.disabled)}else s.$element.addClass(this.options.classes.disabled),s.$options.addClass(this.options.classes.disabled),s.$element.find("input").attr("disabled","disabled")},_onOptionClick:function(t){let s=t.data.instance,e=$(this).attr("id"),i=s._runtime[e]||{};!0===s.options.immediateFeedback&&void 0!=i.option&&t.preventDefault()},_updateRuntime:function(t,s,e,i){let n=this._runtime[t]||{},o=n.options||[],a=n.optionsValues||[];return n.options=o,n.optionsValues=a,this.options.multichoice?i?(o.push(s),e&&a.push(e)):(o.splice(o.indexOf(s),1),e&&a.splice(a.indexOf(e),1)):(o[0]=s,e&&(a[0]=e)),n},_updateQuestionAndOptionUI:function(t,s,i){let n=this._runtime[t];this.options.multichoice?e.target.checked?i.addClass(this.options.classes.selected):this._resetOption(t,s):(n&&n.options.length>0&&this._resetOption(t,n.options[0]),i.addClass(this.options.classes.selected))},_updateQuestionsProperties:function(t,s){1!=this.options.allowChangeOption&&this._disableQuestionOptionsField(t),1==this.options.immediateFeedback&&(void 0!=this.options.allowChangeOption&&1!=this.options.allowChangeOption?this._disableQuestionOptionsField(t):1==this.options.disableNextUntilSuccess&&this._updateNavigationActionsStates(),this._showQuestionStatus(t),this._showOptionStatus(t,s),this._showOptionFeedback(t,s),this._showQuestionFeedback(t,s))},_onOptionChange:function(t){let s=t.data.instance;if(1!=s.options.disabled&&s._state==s.STATES.running){let e,i=$(t.target).parents(s.QUERY_OPTION),n=$(this),o=n.attr("id"),a=i.attr("id"),r=i.find("input").attr("value");for(let t=0,i=s.pendingQuestions.length;t<i;t++){let i=s.pendingQuestions[t];i.id===o&&(e=t,t=s.pendingQuestions.length)}-1!=e&&s.pendingQuestions.splice(e,1),s._updateQuestionAndOptionUI(o,a,i);let h=s._updateRuntime(o,a,r,t.target.checked);s._runtime[o]=h,s.options.multichoice?s._calificateMultiChoiceQuestion(o):s._calificateSingleChoiceQuestion(o),s._updateQuestionsProperties(o,a),0!=s.options.autoGoNext&&1!=s.options.multichoice&&setTimeout(()=>{s.pendingQuestions&&s.pendingQuestions.length>0?s.next():s.end()},s.options.delayOnAutoNext),s.element.triggerHandler(s.ON_OPTION_CHANGE,[s,o,a,r,h])}},_resetOption:function(t,s){let e=this.getQuestionById(t);if(e){let t=e.options[e.optionsMap[s]];t&&(t.$feedbackKo.hide(),t.$feedbackOk.hide(),t.$element.removeClass(this.options.classes.selected+" "+this.options.classes.questionCorrect+" "+this.options.classes.questionIncorrect))}},_setOption:function(t,s){this._super(t,s),"disabled"===t&&(s?this._disable():this._enable())},_hide:function(t){let s=$.Deferred(),e=this.element.triggerHandler(this.ON_QUESTION_HIDE,[this,t]);return void 0!=e&&e.hasOwnProperty("then")?e.then(()=>{this.element.triggerHandler(this.ON_QUESTION_HIDDEN,[this,t]);s.resolveWith(this)}):t.fadeOut(400,()=>{this.element.triggerHandler(this.ON_QUESTION_HIDDEN,[this,t]);s.resolveWith(this)}),s.promise()},_show:function(t){let s=$.Deferred(),e=this.element.triggerHandler(this.ON_QUESTION_SHOW,[this,t]);return void 0!=e&&e.hasOwnProperty("then")?e.then(()=>{this.element.triggerHandler(this.ON_QUESTION_SHOWN,[this,t]);s.resolveWith(this)}):t.fadeIn(400,()=>{this.element.triggerHandler(this.ON_QUESTION_SHOWN,[this,t]);s.resolveWith(this)}),s.promise()},_onHeaderHidden:function(t){t.resolveWith(this)},_hideHeader:function(){let t=$.Deferred();if(this._$header.length>0){let s=this.element.triggerHandler(this.ON_HEADER_HIDE,[this,this._$header]);void 0!=s&&s.hasOwnProperty("then")?s.then(this._onHeaderHidden.bind(this,t)):this._$header.fadeOut(400,this._onHeaderHidden.bind(this,t))}else this._onHeaderHidden(t);return t.promise()},_showHeader:function(){let t=$.Deferred();if(this._$header.length>0){let s=this.element.triggerHandler(this.ON_HEADER_SHOW,[this,this._$header]);void 0!=s&&s.hasOwnProperty("then")?s.then(()=>{t.resolveWith(this)}):this._$header.fadeIn(400,()=>{t.resolveWith(this)})}else t.resolveWith(this);return t.promise()},_onBodyHidden:function(t){t.resolveWith(this)},_hideBody:function(){let t=$.Deferred(),s=this.element.triggerHandler(this.ON_BODY_HIDE,[this,this._$body]);return void 0!=s&&s.hasOwnProperty("then")?s.then(this._onBodyHidden.bind(this,t)):this._$body.fadeOut(400,this._onBodyHidden.bind(this,t)),t.promise()},_showBody:function(){let t=$.Deferred(),s=this.element.triggerHandler(this.ON_BODY_SHOW,[this,this._$body]);return void 0!=s&&s.hasOwnProperty("then")?s.then(()=>{t.resolveWith(this)}):this._$body.fadeIn(400,()=>{t.resolveWith(this)}),t.promise()},_animationStart:function(){let t=$.Deferred(),s=this;return this._hideHeader().then(()=>{this._showBody().then(()=>{t.resolveWith(s)})}),t.promise()},_animationStop:function(){let t=$.Deferred(),s=this;return this._hideBody().then(()=>{this._showHeader().then(()=>{t.resolveWith(s)})}),t.promise()},_disableEnd:function(){this._$endBtn.prop("disabled",!0),this._$endBtn.addClass(this.options.classes.disabled)},_enableEnd:function(){this._$endBtn.prop("disabled",!1),this._$endBtn.removeClass(this.options.classes.disabled)},_disablePrev:function(){this._$prevBtn.prop("disabled",!0),this._$prevBtn.addClass(this.options.classes.disabled)},_enablePrev:function(){this._$prevBtn.prop("disabled",!1),this._$prevBtn.removeClass(this.options.classes.disabled)},_disableNext:function(){this._$nextBtn.prop("disabled",!0),this._$nextBtn.addClass(this.options.classes.disabled)},_enableNext:function(){this._$nextBtn.prop("disabled",!1),this._$nextBtn.removeClass(this.options.classes.disabled)},_disableStart:function(){this._$startBtn.prop("disabled",!0),this._$startBtn.addClass(this.options.classes.disabled)},_enableStart:function(){this._$startBtn.prop("disabled",!1),this._$startBtn.removeClass(this.options.classes.disabled)},_onAnimationStartEnd:function(){let t;t=this._state===this.STATES.running?this.pendingQuestions.length===this._questions.length?this.options.initialQuestion||0:""+this.pendingQuestions[0].id:0,this.goTo(t),this._state==this.STATES.review&&this.showCorrection(),this.element.trigger(this.ON_STARTED,[this])},_onAnimationEndEnd:function(){this.reset()},_onQuestionTransitionEnd(t,s,e){this._updateNavigationActionsStates(),e.resolveWith(this),this.element.triggerHandler(this.ON_TRANSITION_END,[this,t,s])},_updateNavigationActionsStates:function(){let t=this.getQuestionByIndex(this._currentQuestionIndex),s=this._runtime[t.id];if(0===this._currentQuestionIndex?(this._disablePrev(),this._enableNext()):this._currentQuestionIndex===this._questions.length-1?(this._disableNext(),this._enablePrev()):(this._enablePrev(),this._enableNext()),1==this.options.immediateFeedback&&1!=this.options.disableOptionAfterSelect)switch(1!=this.options.disableNextUntilSuccess||void 0!=s&&1==s.isCorrect||this._disableNext(),this.options.disableEndActionUntil){case this.DISABLE_END.beforeAnswerAll:Object.keys(this._runtime),this._questions.length;break;case this.DISABLE_END.beforeAnswerAllCorrect:let t=0,e=this._runtime;for(let s in e){let i=e[s];i.isCorrect&&t++}t==this._questions.length?this._enableEnd():this._disableEnd()}},_onEndShowResult:function(t){t.data.instance.end()},getMaxPoints:function(){return this._maxScore},getId:function(){return this.element.attr("id")},next:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex+1):this.goTo(0)},prev:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex-1):this.goTo(0)},goTo:function(t){let s=$.Deferred(),e=s.promise();if(this._state===this.STATES.running||this._state==this.STATES.review){let e,i=t;"string"==(typeof i).toLowerCase()&&(i=this._questions.findIndex(s=>s.id==t)),e=this._questions[i];let n=this._currentQuestionIndex,o=this._questions[n];void 0!=e&&(void 0==o||o!=e)?(this._disableNext(),this._disablePrev(),this._currentQuestionIndex=i,i==this._questions.length-1?(this.element.removeClass(this.options.classes.firstQuestion),this.element.addClass(this.options.classes.lastQuestion)):0==i?(this.element.removeClass(this.options.classes.lastQuestion),this.element.addClass(this.options.classes.firstQuestion)):(this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion)),this.element.attr(this.ATTR_CURRENT_QUESTION,i),o?this._hide(o.$element).then(()=>{this._show(e.$element).then(this._onQuestionTransitionEnd.bind(this,o,e,s))}):this._show(e.$element).then(this._onQuestionTransitionEnd.bind(this,o,e,s))):s.reject()}return e},getQuestions:function(){return this._questions},getQuestionByIndex:function(t){return this._questions[t]},getQuestionById:function(t){return this.getQuestionByIndex(this._questions.findIndex(s=>s.id==t))},getOptions:function(t){return(this.getQuestionById(t)||{}).options},getOptionByIndex:function(t,s){let e,i=this.getOptions(t);return i&&(e=i[s]),e},getOptionById:function(t,s){let e,i=this.getQuestionById(t);return i&&(e=i.options[i.optionsMap[s]]),e},update:function(){},redrawProperties:function(){this._renderOptions()},reset:function(){this._runtime={},this.pendingQuestions=null,this.completedQuestions=null,this.element.removeAttr(this.ATTR_CURRENT_QUESTION),this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion),this._currentQuestionIndex=null,this._resetUI()},start:function(t){if(1!=this.options.disabled&&this._state===this.STATES.off){if(this._changeState(t&&t.review&&this.STATES.review||this.STATES.running),this._runtime=t&&t.runtime||{},this._questions=this._originalQuestions.slice(),this.pendingQuestions=this._questions.slice(),t&&t.runtime){this._setRuntimeState(t.runtime,this._questions);for(let t in this._runtime)for(let s=0,e=this.pendingQuestions.length;s<e;s++){let e=this.pendingQuestions[s];e.id===t&&(this.pendingQuestions.splice(s,1),s=this.pendingQuestions.length+1)}}this.options.randomize&&(this._questions=this._shuffle(this._questions)),this.element.trigger(this.ON_START,[this]),this._animationStart().then(this._onAnimationStartEnd)}},showResult:function(t){return!!(t&&this.options.showResult&&this._$result.length>0)&&(this._changeState(this.STATES.result),this._renderVar(this.QUERY_RENDER_RESULT,"jqQuizResultItem",t,this._$result),this._$result.dialog(this.options.dialog).one("dialogclose",{instance:this},this._onEndShowResult),!0)},showCorrection:function(){if(this.options.showCorrection){let t=this._questions;for(let s=0,e=t.length;s<e;s++){let e=t[s],i=e.options;for(let t=0,s=i.length;t<s;t++){let s=i[t];this._showOptionStatus(e.id,s.id)}this._disableQuestionOptionsField(e.id)}return this._changeState(this.STATES.review),this.goTo(0),!0}return!1},_shuffle:function(t){for(let s=t.length-1;s>0;s--){const e=Math.floor(Math.random()*(s+1));[t[s],t[e]]=[t[e],t[s]]}return t},_disableAllQuestions:function(){let t=this._questions;for(let s=0,e=t.length;s<e;s++){let e=t[s];this._disableQuestionOptionsField(e.id)}},end:function(){if(this._state===this.STATES.running){let t=this.calificate();return this.lastCalification=t,this._disableAllQuestions(),this.element.trigger(this.ON_END,[this,t,this._runtime]),this.showResult(t)||this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd)),t}return this._state==this.STATES.result?(this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd)),this.lastCalification):this._state==this.STATES.review?(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd),this.lastCalification):void 0},_resetUI:function(){this._$questions.hide(),this._$questions.find("input").prop("checked",!1).removeAttr("disabled"),this._$questions.find("."+this.options.classes.disabled).removeClass(this.options.classes.disabled),this.element.find(this.QUERY_FEEDBACK).hide(),this.element.find("."+this.options.classes.questionCorrect).removeClass(this.options.classes.questionCorrect),this.element.find("."+this.options.classes.questionIncorrect).removeClass(this.options.classes.questionIncorrect),this.element.find("."+this.options.classes.selected).removeClass(this.options.classes.selected)},_getRandomNextQuestionIndex:function(){const t=this.pendingQuestions[Math.floor(Math.random()*this.pendingQuestions.length)];return this._questions.findIndex(s=>s.id==t)},_setRuntimeState:function(t,s){for(let e in t){let i=t[e],n=s.find(t=>t.id===e);if(n)for(let t=0,s=i.options.length;t<s;t++){let s=i.options[t],o=n.optionsMap[s];null!=o&&(n.options[o].$element.find("input").prop("checked",!0),this._updateQuestionAndOptionUI(e,s,n.options[o].$element),this._updateQuestionsProperties(e,s))}}},_changeState:function(t){switch(t){case this.STATES.review:this._state=t,this.element.removeClass(`${this.options.classes.stateRunning} ${this.options.classes.stateResult}`),this.element.addClass(this.options.classes.stateReview);break;case this.STATES.running:this._state=t,this.element.removeClass(`${this.options.classes.stateReview} ${this.options.classes.stateResult}`),this.element.addClass(this.options.classes.stateRunning);break;case this.STATES.result:this._state=t,this.element.removeClass(`${this.options.classes.stateReview} ${this.options.classes.stateRunning}`),this.element.addClass(this.options.classes.stateResult);break;case this.STATES.off:this.element.removeClass(`${this.options.classes.stateResult} ${this.options.classes.stateReview} ${this.options.classes.stateRunning}`),this._state=t}},_disable:function(){this._disableStart()},_enable:function(){this._enableStart()},disable:function(){this._super(),this._disable()},enable:function(){this._super(),this._enable()},destroy:function(){this._$wrapper.removeClass(this.options.classes.wrapper),this._$header.removeClass(this.options.classes.header),this._$body.removeClass(this.options.classes.body),this._$body.show(),this._$properties.removeClass(this.options.classes.properties),this._$questionsWrapper.removeClass(this.options.classes.questions),this._$questions.removeClass(this.options.classes.question),this._$questions.show(),this._$startBtn.removeClass(`${this.options.classes.button} ${this.options.classes.startBtn}`),this._$nextBtn.removeClass(`${this.options.classes.button} ${this.options.classes.nextBtn}`),this._$prevBtn.removeClass(`${this.options.classes.button} ${this.options.classes.prevBtn}`),this._$endBtn.removeClass(`${this.options.classes.button} ${this.options.classes.endBtn}`),this._$result.removeClass(this.options.classes.result),this._$result.data("uiDialog")&&this._$result.dialog("destroy"),this._super()},getRuntime(){return this._runtime}});
