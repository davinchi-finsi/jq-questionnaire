/**
 * @license jq-quiz v2.2.0-beta.3
 * (c) 2018 Finsi, Inc.
 */

!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s():"function"==typeof define&&define.amd?define(s):s()}(0,function(){"use strict";$.widget("ui.jqQuiz",{NAMESPACE:"jqQuiz",QUERY_HEADER:"[data-jq-quiz-header]",QUERY_WRAPPER:"[data-jq-quiz-wrapper]",QUERY_BODY:"[data-jq-quiz-body]",QUERY_PROPERTIES:"[data-jq-quiz-properties]",QUERY_QUESTIONS:"[data-jq-quiz-questions]",QUERY_QUESTION:"[data-jq-quiz-question]",QUERY_OPTIONS:"[data-jq-quiz-options]",QUERY_OPTION:"[data-jq-quiz-option]",QUERY_ACTION_START:"[data-jq-quiz-start]",QUERY_ACTION_NEXT:"[data-jq-quiz-next]",QUERY_ACTION_PREV:"[data-jq-quiz-prev]",QUERY_ACTION_END:"[data-jq-quiz-end]",QUERY_RENDER_OPTION:"[data-jq-quiz-property]",QUERY_RENDER_RESULT:"[data-jq-quiz-result-item]",QUERY_RESULT:"[data-jq-quiz-result]",QUERY_FEEDBACK:"[data-jq-quiz-feedback]",IS_CORRECT:"isCorrect",ATTR_CURRENT_QUESTION:"data-current-question",ATTR_IS_CORRECT:"data-is-correct",ATTR_POINTS_FOR_SUCCESS:"data-points-for-success",ATTR_FEEDBACK:"data-jq-quiz-feedback",ATTR_POINTS_FOR_FAIL:"data-points-for-fail",ON_QUESTION_HIDE:"jqQuiz:questionHide",ON_QUESTION_HIDDEN:"jqQuiz:questionHidden",ON_QUESTION_SHOW:"jqQuiz:questionShow",ON_QUESTION_SHOWN:"jqQuiz:questionShow",ON_HEADER_HIDE:"jqQuiz:headerHide",ON_HEADER_SHOW:"jqQuiz:headerShow",ON_BODY_HIDE:"jqQuiz:bodyHide",ON_BODY_HIDDEN:"jqQuiz:bodyHidden",ON_BODY_SHOW:"jqQuiz:bodyShow",ON_BODY_SHOWN:"jqQuiz:bodyShown",ON_TRANSITION_END:"jqQuiz:transitionEnd",ON_OPTION_CHANGE:"jqQuiz:questionChange",ON_START:"jqQuiz:start",ON_STARTED:"jqQuiz:started",ON_END:"jqQuiz:end",FEEDBACK_TYPES:{ok:"ok",ko:"ko"},STATES:{off:0,running:1,result:2,review:3},DISABLE_END:{never:0,beforeAnswerAll:1,beforeAnswerAllCorrect:2},options:{classes:{firstQuestion:"jq-quiz--first-question",lastQuestion:"jq-quiz--last-question",lastQuestionToAsk:"jq-quiz--last-question-to-ask",widget:"jq-quiz",questionCorrect:"jq-quiz--correct",questionIncorrect:"jq-quiz--incorrect",selected:"jq-quiz--selected",stateResult:"jq-quiz--result",stateReview:"jq-quiz--review",stateRunning:"jq-quiz--running",multichoice:"jq-quiz--multi-choice",wrapper:"jq-quiz__form",header:"jq-quiz__header",body:"jq-quiz__body",startBtn:"jq-quiz__start",nextBtn:"jq-quiz__next",prevBtn:"jq-quiz__prev",endBtn:"jq-quiz__end",result:"jq-quiz__result",question:"jq-quiz__question",option:"jq-quiz__option",navbar:"jq-quiz__navbar",button:"jq-quiz__action",properties:"jq-quiz__properties",questions:"jq-quiz__questions",title:"jq-quiz__title",disabled:"jq-quiz--disabled",property:"jq-quiz__property",actions:"jq-quiz__actions",action:"jq-quiz__action",statement:"jq-quiz__statement",options:"jq-quiz__options",field:"jq-quiz__option-field",feedback:"jq-quiz__feedback",resultItem:"jq-quiz__result-item",label:"jq-quiz__option-label",propertyName:"jq-quiz__property"},delayOnAutoNext:500,pointsForSuccess:1,pointsForFail:0,cutOffMark:50,immediateFeedback:!1,allowChangeOption:!1,autoGoNext:!0,showCorrection:!0,showResult:!0,multichoice:!1,disableNextUntilSuccess:!1,disableEndActionUntil:0,dialog:{draggable:!1,autoOpen:!0,resizable:!1,modal:!0},randomize:!1,initialQuestion:null,autoStart:!1},_create:function(){this.element.addClass(this.options.classes.widget),this.options.quiz&&0==this.element.children().length&&this.element.html(this._renderTemplate()),this._getElements(),this.element.uniqueId(),this._mapQuestions(),this._questions=this._originalQuestions.slice(""),this._changeState(this.STATES.off),this._assignEvents(),this._renderOptions(),this.options.autoStart&&this.start()},_renderOptions:function(){this._renderVar(this.QUERY_RENDER_OPTION,"jqQuizProperty")},_renderVar:function(t,s,e,i){i=i||this.element,e=e||this.options;for(var n,o,a=0,r=i.find(t);a<r.length;a++){var h=r[a],d=$(h),l=d.data(s)||"",u=void 0,c=void 0;if(void 0!=l){l=(n=l.split("?"))[0],u=n[1],l=l.trim(),void 0!=u&&(u=(o=u.split(":"))[0],c=o[1],u.trim(),c.trim());var p=e[l];p=void 0!=p?p:"",void 0!=u&&p?p=u:void 0==c||p||(p=c),d.html(p)}}},_renderTemplate:function(){var t,s=this.options.quiz;return s&&(t='\n                    <form class="'+(this.options.classes.wrapper+(s.wrapper&&s.wrapper.cssClass?0+s.wrapper.cssClass:""))+'" data-jq-quiz-wrapper>\n                        '+this._renderTemplateHeader(s.header)+"\n                        "+this._renderTemplateBody(s.body)+"\n                        "+this._renderTemplateResult(s.result)+"\n                    </form>\n                "),t},_renderTemplateHeader:function(t){var s="";return t&&(s='\n                    <div class="'+(this.options.classes.header+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-header>\n                        '+this._renderTemplateHeaderTitle(t.title)+"\n                        "+this._renderTemplateHeaderDescription(t.description)+"\n                        "+this._renderTemplateHeaderProperties(t.properties)+"\n                        "+this._renderTemplateActions(t.actions)+"\n                    </div>\n                "),s},_renderTemplateHeaderTitle:function(t){var s="";return t&&("string"==(typeof t).toLowerCase()&&(t={tag:"h",level:1,content:t}),"h"!=t.tag||t.level||(t.level=1),s="\n                    <"+t.tag+t.level+' class="'+(this.options.classes.title+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-title>\n                        '+t.content+"\n                    </"+t.tag+t.level+">\n                "),s},_renderTemplateHeaderDescription:function(t){var s="";return t&&("string"==(typeof t).toLowerCase()&&(t={tag:"p",content:t}),s="\n                    <"+(t.tag||"p")+' class="'+(this.options.classes.description+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-description>\n                        '+t.content+"\n                    </"+(t.tag||"p")+">\n                "),s},_renderTemplateHeaderProperties:function(t){var s="";if(t){Array.isArray(t)&&(t={tag:"dl",properties:t});for(var e="",i=0,n=t.properties.length;i<n;i++){var o=t.properties[i];e+=this._renderTemplateHeaderProperty(o)}s="\n                    <"+(t.tag||"dl")+' class="'+(this.options.classes.properties+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-properties>\n                        '+e+"\n                    </"+(t.tag||"dl")+">\n                "}return s},_renderTemplateHeaderProperty:function(t){var s="";return t&&(s="\n                    <"+(t.tagName||"dt")+' class="'+(this.options.classes.propertyName+(t.cssClass?0+t.cssClass:""))+'">\n                        '+t.content+"\n                    </"+(t.tagName||"dt")+">\n                    <"+(t.tagName||"dd")+' class="'+(this.options.classes.propertyName+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-property="'+t.type+'">\n                        \n                    </'+(t.tagName||"dd")+">\n                "),s},_renderTemplateActions:function(t){var s="";if(t){Array.isArray(t)&&(t={tag:"div",actions:t});for(var e="",i=0,n=t.actions.length;i<n;i++){var o=t.actions[i];e+=this._renderTemplateAction(o)}s="\n                    <"+(t.tag||"div")+' class="'+(this.options.classes.actions+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-actions>\n                        '+e+"\n                    </"+(t.tag||"div")+">\n                "}return s},_renderTemplateAction:function(t){var s="";return t&&(s="\n                    <"+(t.tagName||"button")+' class="'+(this.options.classes.action+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-'+t.type+">\n                        "+t.content+"\n                    </"+(t.tagName||"button")+">\n                "),s},_renderTemplateBody:function(t){var s="";return t&&(s="\n                    <"+(t.tag||"div")+' class="'+(this.options.classes.body+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-body>\n                        '+this._renderTemplateBodyQuestions(t.questions)+"\n                        "+this._renderTemplateActions(t.actions)+"\n                    </"+(t.tag||"div")+">\n                "),s},_renderTemplateBodyQuestions:function(t){var s="";if(t&&Array.isArray(t)){Array.isArray(t)&&(t={questions:t});for(var e="",i=0,n=t.questions;i<n.length;i++){var o=n[i];e+=this._renderTemplateBodyQuestion(o)}s="\n                    <"+(t.tag||"div")+' class="'+(this.options.classes.questions+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-questions>\n                        '+e+"\n                    </"+(t.tag||"div")+">\n                "}return s},_renderTemplateBodyQuestion:function(t){var s="";return t&&(s="\n                    <"+(t.tag||"fieldset")+' class="'+(this.options.classes.question+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-question>\n                        '+this._renderTemplateBodyQuestionStatement(t.content)+"\n                        "+this._renderTemplateBodyQuestionOptions(t.options)+"\n                        "+this._renderTemplateBodyQuestionFeedback(t.feedback)+"\n                    </"+(t.tag||"fieldset")+">\n                "),s},_renderTemplateBodyQuestionStatement:function(t){var s="";return t&&("string"==(typeof t).toLowerCase()&&(t={content:t}),s="\n                    <"+(t.tag||"legend")+' class="'+(this.options.classes.statement+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-statement>\n                        '+t.content+"\n                    </"+(t.tag||"legend")+">\n                "),s},_renderTemplateBodyQuestionOptions:function(t){var s="";if(t){var e="";Array.isArray(t)&&(t={options:t});for(var i=0,n=t.options;i<n.length;i++){var o=n[i];e+=this._renderTemplateBodyQuestionOption(o)}s="\n                    <"+(t.tag||"ul")+'  class="'+(this.options.classes.options+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-options>\n                        '+e+"\n                    </"+(t.tag||"ul")+">\n                "}return s},_renderTemplateBodyQuestionOption:function(t){var s="";return t&&(t.label=t.label||{},t.field=t.field||{},s="\n                    <"+(t.tag||"li")+' class="'+(this.options.classes.option+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-option data-is-correct="'+!!t.isCorrect+'">\n                        <label class="'+(this.options.classes.label+(t.label.cssClass?0+t.label.cssClass:""))+'"\n                                '+(t.field&&t.field.id?"for="+t.field.id:"")+">\n                                <span>"+t.content+"</span>\n                                <input "+(t.field&&t.field.id?"id="+t.field.id:"")+'\n                                       class="'+(this.options.classes.field+(t.field.cssClass?0+t.field.cssClass:""))+'" \n                                       type="'+(this.options.multichoice?"checkbox":"radio")+'"\n                                       '+(t.field&&t.field.required?"required":"")+"\n                                       "+(t.name?"name="+t.name:"")+"\n                                       "+(t.value?"value="+t.value:"")+"\n                                />\n                                \n                        </label>\n                        "+this._renderTemplateBodyQuestionFeedback(t.feedback)+"  \n                    </"+(t.tag||"li")+">\n                "),s},_renderTemplateBodyQuestionFeedback:function(t){var s="";if(t&&Array.isArray(t))for(var e=0,i=t;e<i.length;e++){var n=i[e];s+="\n                        <"+(n.tag||"div")+'  class="'+(this.options.classes.feedback+(n.cssClass?0+n.cssClass:""))+'" data-jq-quiz-feedback="'+n.type+'">\n                            '+n.content+"\n                        </"+(n.tag||"div")+">\n                    "}return s},_renderTemplateResult:function(t){var s="";if(t){Array.isArray(t)&&(t={items:t});for(var e="",i=0,n=t.items;i<n.length;i++){var o=n[i];e+=this._renderTemplateResultItem(o)}s="\n                    <"+(t.tag||"div")+' class="'+(this.options.classes.result+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-result>\n                        '+e+"\n                    </"+(t.tag||"div")+">\n                "}return s},_renderTemplateResultItem:function(t){var s="";return t&&(s="\n                    <"+(t.tagName||"dt")+' class="'+(this.options.classes.resultItem+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-result-item-label="'+t.type+'">\n                        '+t.content+"\n                    </"+(t.tagName||"dt")+">\n                    <"+(t.tagName||"dd")+' class="'+(this.options.classes.resultItem+(t.cssClass?0+t.cssClass:""))+'" data-jq-quiz-result-item="'+t.type+'">\n                        \n                    </'+(t.tagName||"dd")+">\n                "),s},_getElements:function(){this._$wrapper=this.element.find(this.QUERY_WRAPPER).addClass(this.options.classes.wrapper),this._$header=this.element.find(this.QUERY_HEADER).addClass(this.options.classes.header),this._$body=this.element.find(this.QUERY_BODY).addClass(this.options.classes.body),this._$body.hide(),this._$properties=this.element.find(this.QUERY_PROPERTIES).addClass(this.options.classes.properties),this._$questionsWrapper=this.element.find(this.QUERY_QUESTIONS).addClass(this.options.classes.questions),this._$questions=this._$questionsWrapper.find(this.QUERY_QUESTION).addClass(this.options.classes.question),this._$questions.hide(),this._$startBtn=this._$wrapper.find(this.QUERY_ACTION_START).addClass(this.options.classes.button+" "+this.options.classes.startBtn),this._$nextBtn=this._$wrapper.find(this.QUERY_ACTION_NEXT).addClass(this.options.classes.button+" "+this.options.classes.nextBtn),this._$prevBtn=this._$wrapper.find(this.QUERY_ACTION_PREV).addClass(this.options.classes.button+" "+this.options.classes.prevBtn),this._$endBtn=this._$wrapper.find(this.QUERY_ACTION_END).addClass(this.options.classes.button+" "+this.options.classes.endBtn),this._$result=this._$wrapper.find(this.QUERY_RESULT).addClass(this.options.classes.result),this._$result.hide()},_mapQuestions:function(){var t=this._$questions.find(this.QUERY_OPTION).find(":checkbox");t.length>0?(t.attr("type","checkbox"),this.options.multichoice=!0,this.element.addClass(this.options.classes.multichoice)):t.attr("type","radio");for(var s=this._$questions,e=[],i=0,n=0,o=s.length;n<o;n++){var a=$(s[n]),r=this._mapQuestion(a);e.push(r),i+=r.pointsForSuccess}this._originalQuestions=e,this._maxScore=i,this._setOption("maxScore",i)},_mapQuestion:function(t){var s,e=t.find(this.QUERY_OPTIONS),i=e.find(this.QUERY_OPTION),n=i.first().find("input").attr("name"),o=t.data(this.ATTR_POINTS_FOR_SUCCESS),a=t.data(this.ATTR_POINTS_FOR_FAIL),r=this._mapOptions(i),h=r.arr,d=r.map,l=t.find(this.QUERY_FEEDBACK).not(this.QUERY_OPTION+" "+this.QUERY_FEEDBACK);l.hide(),t.removeAttr(this.ATTR_POINTS_FOR_FAIL),t.removeAttr(this.ATTR_POINTS_FOR_SUCCESS),t.uniqueId(),s=t.attr("id"),n=void 0!=n?n:s,i.find("input").attr("name",n);for(var u={id:s,$element:t,$optionsWrapper:e,$options:i,options:h,optionsMap:d,pointsForSuccess:void 0!=o?o:this.options.pointsForSuccess,pointsForFail:void 0!=a?a:this.options.pointsForFail},c=0,p=l;c<p.length;c++){var _=p[c],f=$(_);switch(f.attr(this.ATTR_FEEDBACK)){case this.FEEDBACK_TYPES.ok:u.$feedbackOk=f;break;case this.FEEDBACK_TYPES.ko:u.$feedbackKo=f;break;default:u.$feedback=f}}return u.$feedbackOk=u.$feedbackOk||u.$feedback||$(null),u.$feedbackKo=u.$feedbackKo||u.$feedback||$(null),u},_mapOptions:function(t){for(var s=[],e={},i=0,n=t.length;i<n;i++){var o=$(t[i]),a=this._mapOption(o);s.push(a),e[a.id]=i}return{arr:s,map:e}},_mapOption:function(t){var s=!!t.data(this.IS_CORRECT),e=t.find(this.QUERY_FEEDBACK);t.removeAttr(this.ATTR_IS_CORRECT),t.uniqueId();for(var i={id:t.attr("id"),$element:t,isCorrect:s},n=0,o=e;n<o.length;n++){var a=o[n],r=$(a);switch(r.attr(this.ATTR_FEEDBACK)){case this.FEEDBACK_TYPES.ok:i.$feedbackOk=r;break;case this.FEEDBACK_TYPES.ko:i.$feedbackKo=r;break;default:i.$feedback=r}}return i.$feedbackOk=i.$feedbackOk||i.$feedback||$(null),i.$feedbackKo=i.$feedbackKo||i.$feedback||$(null),e.hide(),i},_assignEvents:function(){this._$startBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onStartButtonClick),this._$endBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onEndButtonClick),this._$nextBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onNextButtonClick),this._$prevBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onPrevButtonClick),this._$questions.off(this.NAMESPACE).on("change."+this.NAMESPACE,{instance:this},this._onOptionChange)},_onStartButtonClick:function(t){t.preventDefault(),t.data.instance.start()},_onEndButtonClick:function(t){t.preventDefault(),t.data.instance.end()},_onNextButtonClick:function(t){t.preventDefault(),t.data.instance.next()},_onPrevButtonClick:function(t){t.preventDefault(),t.data.instance.prev()},calificate:function(t){var s,e=0,i=this._maxScore,n=t||this._runtime,o=this._questions,a=0,r=0;if(void 0!=this._runtime||void 0!=t){var h;if(1!=this.options.multichoice)a=(h=this._calificateSingleChoice(n)).nSuccess,r=h.nFails,e=h.score;else a=(h=this._calificateMultiChoice(n)).nSuccess,r=h.nFails,e=h.score;(s={maxScore:i,score:e,percentage:100*e/i,questionsSuccess:a,questionsFail:r,questionsNotAttempted:o.length-(a+r)}).success=s.percentage>=this.options.cutOffMark}else console.log("[jqQuiz] WARN: calificate must be used when the quiz is in running or review state or with a specific runtime");return s},_calificateSingleChoice:function(t){for(var s=0,e=t||this._runtime,i=this._questions,n=0,o=0,a=0,r=i.length;a<r;a++){var h=i[a],d=(e[h.id],this._calificateSingleChoiceQuestion(h.id,t));void 0!=d&&(d?(s+=h.pointsForSuccess,n++):(o++,s>=h.pointsForFail&&(s-=h.pointsForFail)))}return{nSuccess:n,nFails:o,score:s}},_calificateSingleChoiceQuestion:function(t,s){var e,i=s||this._runtime,n=this.getQuestionById(t);if(n){var o=i[n.id];if(o&&o.options.length>0)e=n.options[n.optionsMap[o.options[0]]].isCorrect,o.isCorrect=e}return e},_calificateMultiChoiceQuestion:function(t,s){var e,i=s||this._runtime,n=this.getQuestionById(t);if(n){var o=i[n.id];if(o){for(var a=n.options,r=o.options,h=0,d=0,l=0,u=0,c=a.length;u<c;u++){var p=a[u],_=-1!=r.indexOf(p.id);p.isCorrect?(d++,h+=_?1:0):_&&(l++,u=c)}e=0==l&&h==d,o.isCorrect=e}}return e},_calificateMultiChoice:function(t){for(var s=0,e=t||this._runtime,i=this._questions,n=0,o=0,a=0,r=i.length;a<r;a++){var h=i[a],d=(e[h.id],this._calificateMultiChoiceQuestion(h.id,t));void 0!=d&&(d?(n++,s+=h.pointsForSuccess):(o++,s>=h.pointsForFail&&(s-=h.pointsForFail)))}return{nSuccess:n,nFails:o,score:s}},_showOptionStatus:function(t,s){var e=this.getQuestionById(t);if(e){var i=this._runtime[e.id],n=e.options[e.optionsMap[s]];if(i&&n)-1!=i.options.indexOf(s)?n.$element.addClass(n.isCorrect?this.options.classes.questionCorrect:this.options.classes.questionIncorrect):n.$element.addClass(n.isCorrect?this.options.classes.questionIncorrect:"");else n.$element.addClass(n.isCorrect?this.options.classes.questionIncorrect:"")}},_showQuestionStatus:function(t){var s=this.getQuestionById(t);if(s){var e=this._runtime[s.id];if(e&&void 0!=e.option){var i=s.options;e.isCorrect?s.$element.addClass(this.options.classes.questionCorrect):s.$element.addClass(this.options.classes.questionIncorrect);for(var n=0,o=i;n<o.length;n++){var a=o[n];a.isCorrect?a.$element.addClass(this.options.classes.questionCorrect):a.$element.addClass(this.options.classes.questionIncorrect)}}}},_showOptionFeedback:function(t,s){var e=this.getQuestionById(t);if(e){var i=this._runtime[e.id],n=e.options[e.optionsMap[s]];if(i&&n)-1!=i.options.indexOf(s)&&(n.isCorrect?(n.$feedbackKo.hide(),n.$feedbackOk.show()):(n.$feedbackOk.hide(),n.$feedbackKo.show()))}},_showQuestionFeedback:function(t){var s=this.getQuestionById(t);if(s){var e=this._runtime[s.id];if(e&&void 0!=e)this.getOptionById(t,e.options[0]).isCorrect?(s.$feedbackKo.hide(),s.$feedbackOk.show()):(s.$feedbackOk.hide(),s.$feedbackKo.show())}},_disableQuestionOptionsField:function(t){var s=this.getQuestionById(t);if(s)if(this.options.multichoice&&this._state==this.STATES.running){s.$element.find(":checked").attr("disabled","disabled");for(var e=0,i=s.options;e<i.length;e++){var n=i[e];n.$element.find(":checked").length>0&&n.$element.addClass(this.options.classes.disabled)}}else s.$element.addClass(this.options.classes.disabled),s.$options.addClass(this.options.classes.disabled),s.$element.find("input").attr("disabled","disabled")},_onOptionClick:function(t){var s=t.data.instance,e=$(this).attr("id"),i=s._runtime[e]||{};!0===s.options.immediateFeedback&&void 0!=i.option&&t.preventDefault()},_updateRuntime:function(t,s,e,i){var n=this._runtime[t]||{},o=n.options||[],a=n.optionsValues||[];return n.options=o,n.optionsValues=a,this.options.multichoice?i?(o.push(s),e&&a.push(e)):(o.splice(o.indexOf(s),1),e&&a.splice(a.indexOf(e),1)):(o[0]=s,e&&(a[0]=e)),n},_updateQuestionAndOptionUI:function(t,s,i){var n=this._runtime[t];this.options.multichoice?e.target.checked?i.addClass(this.options.classes.selected):this._resetOption(t,s):(n&&n.options.length>0&&this._resetOption(t,n.options[0]),i.addClass(this.options.classes.selected))},_updateQuestionsProperties:function(t,s){1!=this.options.allowChangeOption&&this._disableQuestionOptionsField(t),1==this.options.immediateFeedback&&(void 0!=this.options.allowChangeOption&&1!=this.options.allowChangeOption?this._disableQuestionOptionsField(t):1==this.options.disableNextUntilSuccess&&this._updateNavigationActionsStates(),this._showQuestionStatus(t),this._showOptionStatus(t,s),this._showOptionFeedback(t,s),this._showQuestionFeedback(t,s))},_onOptionChange:function(t){var s=t.data.instance;if(1!=s.options.disabled&&s._state==s.STATES.running){for(var e=$(t.target).parents(s.QUERY_OPTION),i=$(this).attr("id"),n=e.attr("id"),o=e.find("input").attr("value"),a=void 0,r=0,h=s.pendingQuestions.length;r<h;r++){s.pendingQuestions[r].id===i&&(a=r,r=s.pendingQuestions.length)}-1!=a&&s.pendingQuestions.splice(a,1),s._updateQuestionAndOptionUI(i,n,e);var d=s._updateRuntime(i,n,o,t.target.checked);s._runtime[i]=d,s.options.multichoice?s._calificateMultiChoiceQuestion(i):s._calificateSingleChoiceQuestion(i),s._updateQuestionsProperties(i,n),0!=s.options.autoGoNext&&1!=s.options.multichoice&&setTimeout(function(){s.pendingQuestions&&s.pendingQuestions.length>0?s.next():s.end()},s.options.delayOnAutoNext),s.element.triggerHandler(s.ON_OPTION_CHANGE,[s,i,n,o,d])}},_resetOption:function(t,s){var e=this.getQuestionById(t);if(e){var i=e.options[e.optionsMap[s]];i&&(i.$feedbackKo.hide(),i.$feedbackOk.hide(),i.$element.removeClass(this.options.classes.selected+" "+this.options.classes.questionCorrect+" "+this.options.classes.questionIncorrect))}},_setOption:function(t,s){this._super(t,s),"disabled"===t&&(s?this._disable():this._enable())},_hide:function(t){var s=this,e=$.Deferred(),i=this.element.triggerHandler(this.ON_QUESTION_HIDE,[this,t]);return void 0!=i&&i.hasOwnProperty("then")?i.then(function(){s.element.triggerHandler(s.ON_QUESTION_HIDDEN,[s,t]),e.resolveWith(s)}):t.fadeOut(400,function(){s.element.triggerHandler(s.ON_QUESTION_HIDDEN,[s,t]),e.resolveWith(s)}),e.promise()},_show:function(t){var s=this,e=$.Deferred(),i=this.element.triggerHandler(this.ON_QUESTION_SHOW,[this,t]);return void 0!=i&&i.hasOwnProperty("then")?i.then(function(){s.element.triggerHandler(s.ON_QUESTION_SHOWN,[s,t]),e.resolveWith(s)}):t.fadeIn(400,function(){s.element.triggerHandler(s.ON_QUESTION_SHOWN,[s,t]),e.resolveWith(s)}),e.promise()},_onHeaderHidden:function(t){t.resolveWith(this)},_hideHeader:function(){var t=$.Deferred();if(this._$header.length>0){var s=this.element.triggerHandler(this.ON_HEADER_HIDE,[this,this._$header]);void 0!=s&&s.hasOwnProperty("then")?s.then(this._onHeaderHidden.bind(this,t)):this._$header.fadeOut(400,this._onHeaderHidden.bind(this,t))}else this._onHeaderHidden(t);return t.promise()},_showHeader:function(){var t=this,s=$.Deferred();if(this._$header.length>0){var e=this.element.triggerHandler(this.ON_HEADER_SHOW,[this,this._$header]);void 0!=e&&e.hasOwnProperty("then")?e.then(function(){s.resolveWith(t)}):this._$header.fadeIn(400,function(){s.resolveWith(t)})}else s.resolveWith(this);return s.promise()},_onBodyHidden:function(t){t.resolveWith(this)},_hideBody:function(){var t=$.Deferred(),s=this.element.triggerHandler(this.ON_BODY_HIDE,[this,this._$body]);return void 0!=s&&s.hasOwnProperty("then")?s.then(this._onBodyHidden.bind(this,t)):this._$body.fadeOut(400,this._onBodyHidden.bind(this,t)),t.promise()},_showBody:function(){var t=this,s=$.Deferred(),e=this.element.triggerHandler(this.ON_BODY_SHOW,[this,this._$body]);return void 0!=e&&e.hasOwnProperty("then")?e.then(function(){s.resolveWith(t)}):this._$body.fadeIn(400,function(){s.resolveWith(t)}),s.promise()},_animationStart:function(){var t=this,s=$.Deferred(),e=this;return this._hideHeader().then(function(){t._showBody().then(function(){s.resolveWith(e)})}),s.promise()},_animationStop:function(){var t=this,s=$.Deferred(),e=this;return this._hideBody().then(function(){t._showHeader().then(function(){s.resolveWith(e)})}),s.promise()},_disableEnd:function(){this._$endBtn.prop("disabled",!0),this._$endBtn.addClass(this.options.classes.disabled)},_enableEnd:function(){this._$endBtn.prop("disabled",!1),this._$endBtn.removeClass(this.options.classes.disabled)},_disablePrev:function(){this._$prevBtn.prop("disabled",!0),this._$prevBtn.addClass(this.options.classes.disabled)},_enablePrev:function(){this._$prevBtn.prop("disabled",!1),this._$prevBtn.removeClass(this.options.classes.disabled)},_disableNext:function(){this._$nextBtn.prop("disabled",!0),this._$nextBtn.addClass(this.options.classes.disabled)},_enableNext:function(){this._$nextBtn.prop("disabled",!1),this._$nextBtn.removeClass(this.options.classes.disabled)},_disableStart:function(){this._$startBtn.prop("disabled",!0),this._$startBtn.addClass(this.options.classes.disabled)},_enableStart:function(){this._$startBtn.prop("disabled",!1),this._$startBtn.removeClass(this.options.classes.disabled)},_onAnimationStartEnd:function(){var t;t=this._state===this.STATES.running?this.pendingQuestions.length===this._questions.length?this.options.initialQuestion||0:""+this.pendingQuestions[0].id:0,this.goTo(t),this._state==this.STATES.review&&this.showCorrection(),this.element.trigger(this.ON_STARTED,[this])},_onAnimationEndEnd:function(){this.reset()},_onQuestionTransitionEnd:function(t,s,e){this._updateNavigationActionsStates(),e.resolveWith(this),this.element.triggerHandler(this.ON_TRANSITION_END,[this,t,s])},_updateNavigationActionsStates:function(){var t=this.getQuestionByIndex(this._currentQuestionIndex),s=this._runtime[t.id];if(0===this._currentQuestionIndex?(this._disablePrev(),this._enableNext()):this._currentQuestionIndex===this._questions.length-1?(this._disableNext(),this._enablePrev()):(this._enablePrev(),this._enableNext()),1==this.options.immediateFeedback&&1!=this.options.disableOptionAfterSelect)switch(1!=this.options.disableNextUntilSuccess||void 0!=s&&1==s.isCorrect||this._disableNext(),this.options.disableEndActionUntil){case this.DISABLE_END.beforeAnswerAll:Object.keys(this._runtime),this._questions.length;break;case this.DISABLE_END.beforeAnswerAllCorrect:var e=0,i=this._runtime;for(var n in i){i[n].isCorrect&&e++}e==this._questions.length?this._enableEnd():this._disableEnd()}},_onEndShowResult:function(t){t.data.instance.end()},getMaxPoints:function(){return this._maxScore},getId:function(){return this.element.attr("id")},next:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex+1):this.goTo(0)},prev:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex-1):this.goTo(0)},goTo:function(t){var s=this,e=$.Deferred(),i=e.promise();if(this._state===this.STATES.running||this._state==this.STATES.review){var n,o=t;"string"==(typeof o).toLowerCase()&&(o=this._questions.findIndex(function(s){return s.id==t})),n=this._questions[o];var a=this._currentQuestionIndex,r=this._questions[a];void 0!=n&&(void 0==r||r!=n)?(this._disableNext(),this._disablePrev(),this._currentQuestionIndex=o,o==this._questions.length-1?(this.element.removeClass(this.options.classes.firstQuestion),this.element.addClass(this.options.classes.lastQuestion)):0==o?(this.element.removeClass(this.options.classes.lastQuestion),this.element.addClass(this.options.classes.firstQuestion)):(this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion)),this.element.attr(this.ATTR_CURRENT_QUESTION,o),r?this._hide(r.$element).then(function(){s._show(n.$element).then(s._onQuestionTransitionEnd.bind(s,r,n,e))}):this._show(n.$element).then(this._onQuestionTransitionEnd.bind(this,r,n,e))):e.reject()}return i},getQuestions:function(){return this._questions},getQuestionByIndex:function(t){return this._questions[t]},getQuestionById:function(t){return this.getQuestionByIndex(this._questions.findIndex(function(s){return s.id==t}))},getOptions:function(t){return(this.getQuestionById(t)||{}).options},getOptionByIndex:function(t,s){var e,i=this.getOptions(t);return i&&(e=i[s]),e},getOptionById:function(t,s){var e,i=this.getQuestionById(t);return i&&(e=i.options[i.optionsMap[s]]),e},update:function(){},redrawProperties:function(){this._renderOptions()},reset:function(){this._runtime={},this.pendingQuestions=null,this.completedQuestions=null,this.element.removeAttr(this.ATTR_CURRENT_QUESTION),this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion),this._currentQuestionIndex=null,this._resetUI()},start:function(t){if(1!=this.options.disabled&&this._state===this.STATES.off){if(this._changeState(t&&t.review&&this.STATES.review||this.STATES.running),this._runtime=t&&t.runtime||{},this._questions=this._originalQuestions.slice(),this.pendingQuestions=this._questions.slice(),t&&t.runtime)for(var s in this._setRuntimeState(t.runtime,this._questions),this._runtime)for(var e=0,i=this.pendingQuestions.length;e<i;e++){this.pendingQuestions[e].id===s&&(this.pendingQuestions.splice(e,1),e=this.pendingQuestions.length+1)}this.options.randomize&&(this._questions=this._shuffle(this._questions)),this.element.trigger(this.ON_START,[this]),this._animationStart().then(this._onAnimationStartEnd)}},showResult:function(t){return!!(t&&this.options.showResult&&this._$result.length>0)&&(this._changeState(this.STATES.result),this._renderVar(this.QUERY_RENDER_RESULT,"jqQuizResultItem",t,this._$result),this._$result.dialog(this.options.dialog).one("dialogclose",{instance:this},this._onEndShowResult),!0)},showCorrection:function(){if(this.options.showCorrection){for(var t=this._questions,s=0,e=t.length;s<e;s++){for(var i=t[s],n=i.options,o=0,a=n.length;o<a;o++){var r=n[o];this._showOptionStatus(i.id,r.id)}this._disableQuestionOptionsField(i.id)}return this._changeState(this.STATES.review),this.goTo(0),!0}return!1},_shuffle:function(t){for(var s=t.length-1;s>0;s--){var e=Math.floor(Math.random()*(s+1));i=[t[e],t[s]],t[s]=i[0],t[e]=i[1]}return t;var i},_disableAllQuestions:function(){for(var t=this._questions,s=0,e=t.length;s<e;s++){var i=t[s];this._disableQuestionOptionsField(i.id)}},end:function(){if(this._state===this.STATES.running){var t=this.calificate();return this.lastCalification=t,this._disableAllQuestions(),this.element.trigger(this.ON_END,[this,t,this._runtime]),this.showResult(t)||this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd)),t}return this._state==this.STATES.result?(this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd)),this.lastCalification):this._state==this.STATES.review?(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd),this.lastCalification):void 0},_resetUI:function(){this._$questions.hide(),this._$questions.find("input").prop("checked",!1).removeAttr("disabled"),this._$questions.find("."+this.options.classes.disabled).removeClass(this.options.classes.disabled),this.element.find(this.QUERY_FEEDBACK).hide(),this.element.find("."+this.options.classes.questionCorrect).removeClass(this.options.classes.questionCorrect),this.element.find("."+this.options.classes.questionIncorrect).removeClass(this.options.classes.questionIncorrect),this.element.find("."+this.options.classes.selected).removeClass(this.options.classes.selected)},_getRandomNextQuestionIndex:function(){var t=this.pendingQuestions[Math.floor(Math.random()*this.pendingQuestions.length)];return this._questions.findIndex(function(s){return s.id==t})},_setRuntimeState:function(t,s){var e=function(e){var n=t[e],o=s.find(function(t){return t.id===e});if(o)for(var a=0,r=n.options.length;a<r;a++){var h=n.options[a],d=o.optionsMap[h];null!=d&&(o.options[d].$element.find("input").prop("checked",!0),i._updateQuestionAndOptionUI(e,h,o.options[d].$element),i._updateQuestionsProperties(e,h))}},i=this;for(var n in t)e(n)},_changeState:function(t){switch(t){case this.STATES.review:this._state=t,this.element.removeClass(this.options.classes.stateRunning+" "+this.options.classes.stateResult),this.element.addClass(this.options.classes.stateReview);break;case this.STATES.running:this._state=t,this.element.removeClass(this.options.classes.stateReview+" "+this.options.classes.stateResult),this.element.addClass(this.options.classes.stateRunning);break;case this.STATES.result:this._state=t,this.element.removeClass(this.options.classes.stateReview+" "+this.options.classes.stateRunning),this.element.addClass(this.options.classes.stateResult);break;case this.STATES.off:this.element.removeClass(this.options.classes.stateResult+" "+this.options.classes.stateReview+" "+this.options.classes.stateRunning),this._state=t}},_disable:function(){this._disableStart()},_enable:function(){this._enableStart()},disable:function(){this._super(),this._disable()},enable:function(){this._super(),this._enable()},destroy:function(){this._$wrapper.removeClass(this.options.classes.wrapper),this._$header.removeClass(this.options.classes.header),this._$body.removeClass(this.options.classes.body),this._$body.show(),this._$properties.removeClass(this.options.classes.properties),this._$questionsWrapper.removeClass(this.options.classes.questions),this._$questions.removeClass(this.options.classes.question),this._$questions.show(),this._$startBtn.removeClass(this.options.classes.button+" "+this.options.classes.startBtn),this._$nextBtn.removeClass(this.options.classes.button+" "+this.options.classes.nextBtn),this._$prevBtn.removeClass(this.options.classes.button+" "+this.options.classes.prevBtn),this._$endBtn.removeClass(this.options.classes.button+" "+this.options.classes.endBtn),this._$result.removeClass(this.options.classes.result),this._$result.data("uiDialog")&&this._$result.dialog("destroy"),this._super()},getRuntime:function(){return this._runtime}})});
