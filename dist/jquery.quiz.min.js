/**
 * jqQuiz plugin v0.5.0 | Davinchi | https://github.com/davinchi-finsi/jq-quiz/blob/master/LICENSE
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery","./controlgroup","./checkboxradio","../keycode","../widget"],t):t(jQuery)}(function(t){return t.widget("ui.jqQuiz",{NAMESPACE:"jqQuiz",QUERY_HEADER:"[data-jq-quiz-header]",QUERY_WRAPPER:"[data-jq-quiz-wrapper]",QUERY_BODY:"[data-jq-quiz-body]",QUERY_PROPERTIES:"[data-jq-quiz-properties]",QUERY_QUESTIONS:"[data-jq-quiz-questions]",QUERY_QUESTION:"[data-jq-quiz-question]",QUERY_OPTIONS:"[data-jq-quiz-options]",QUERY_OPTION:"[data-jq-quiz-option]",QUERY_ACTION_START:"[data-jq-quiz-start]",QUERY_ACTION_NEXT:"[data-jq-quiz-next]",QUERY_ACTION_PREV:"[data-jq-quiz-prev]",QUERY_ACTION_END:"[data-jq-quiz-end]",QUERY_RENDER_OPTION:"[data-jq-quiz-property]",QUERY_RENDER_RESULT:"[data-jq-quiz-result-item]",QUERY_RESULT:"[data-jq-quiz-result]",QUERY_FEEDBACK:"[data-jq-quiz-feedback]",IS_CORRECT:"isCorrect",ATTR_CURRENT_QUESTION:"data-current-question",ATTR_IS_CORRECT:"data-is-correct",ATTR_POINTS_FOR_SUCCESS:"data-points-for-success",ATTR_FEEDBACK:"data-jq-quiz-feedback",ATTR_POINTS_FOR_FAIL:"data-points-for-fail",ON_QUESTION_HIDE:"jqQuiz:questionHide",ON_QUESTION_SHOW:"jqQuiz:questionShow",ON_HEADER_HIDE:"jqQuiz:headerHide",ON_HEADER_SHOW:"jqQuiz:headerShow",ON_BODY_HIDE:"jqQuiz:bodyHide",ON_BODY_SHOW:"jqQuiz:bodyShow",ON_TRANSITION_END:"jqQuiz:transitionEnd",ON_OPTION_CHANGE:"jqQuiz:questionChange",ON_START:"jqQuiz:start",ON_STARTED:"jqQuiz:started",ON_END:"jqQuiz:end",FEEDBACK_TYPES:{ok:"ok",ko:"ko"},STATES:{off:0,running:1,result:2,review:3},DISABLE_END:{never:0,beforeAnswerAll:1,beforeAnswerAllCorrect:2},options:{classes:{firstQuestion:"jq-quiz--first-question",lastQuestion:"jq-quiz--last-question",widget:"jq-quiz",questionCorrect:"jq-quiz--correct",questionIncorrect:"jq-quiz--incorrect",selected:"jq-quiz--selected",stateResult:"jq-quiz--result",stateReview:"jq-quiz--review",stateRunning:"jq-quiz--running",multichoice:"jq-quiz--multi-choice",wrapper:"jq-quiz__form",header:"jq-quiz__header",body:"jq-quesitonnaire__body",startBtn:"jq-quiz__start",nextBtn:"jq-quiz__next",prevBtn:"jq-quiz__prev",endBtn:"jq-quiz__end",result:"jq-quiz__result",question:"jq-quiz__question",option:"jq-quiz__option",navbar:"jq-quiz__navbar",button:"jq-quiz__action",properties:"jq-quiz__properties",questions:"jq-quiz__questions"},delayOnAutoNext:500,pointsForSuccess:1,pointsForFail:0,cutOffMark:50,immediateFeedback:!1,disableOptionAfterSelect:!0,autoGoNext:!0,showCorrection:!0,showResult:!0,multichoice:!1,disableNextUntilSuccess:!1,disableEndActionUntil:0,dialog:{draggable:!1,autoOpen:!0,resizable:!1,modal:!0}},_create:function(){this._getElements(),this.element.uniqueId(),this._mapQuestions(),this._changeState(this.STATES.off),this._assignEvents(),this._renderOptions()},_renderOptions:function(){this._renderVar(this.QUERY_RENDER_OPTION,"jqQuizProperty")},_renderVar:function(s,i,e,n){n=n||this.element,e=e||this.options;for(var o=n.find(s),a=0,r=o;a<r.length;a++){var h=r[a],d=t(h),u=d.data(i)||"",l=void 0,c=void 0;if(void 0!=u){p=u.split("?"),u=p[0],l=p[1],u=u.trim(),void 0!=l&&(f=l.split(":"),l=f[0],c=f[1],l.trim(),c.trim());var _=e[u];_=void 0!=_?_:"",void 0!=l&&_?_=l:void 0==c||_||(_=c),d.html(_)}}var p,f},_getElements:function(){this._$wrapper=this.element.find(this.QUERY_WRAPPER).addClass(this.options.classes.wrapper),this._$header=this.element.find(this.QUERY_HEADER).addClass(this.options.classes.header),this._$body=this.element.find(this.QUERY_BODY).addClass(this.options.classes.body),this._$body.hide(),this._$properties=this.element.find(this.QUERY_PROPERTIES).addClass(this.options.classes.properties),this._$questionsWrapper=this.element.find(this.QUERY_QUESTIONS).addClass(this.options.classes.questions),this._$questions=this._$questionsWrapper.find(this.QUERY_QUESTION).addClass(this.options.classes.question),this._$questions.hide(),this._$startBtn=this._$wrapper.find(this.QUERY_ACTION_START).addClass(this.options.classes.button+" "+this.options.classes.startBtn),this._$nextBtn=this._$wrapper.find(this.QUERY_ACTION_NEXT).addClass(this.options.classes.button+" "+this.options.classes.nextBtn),this._$prevBtn=this._$wrapper.find(this.QUERY_ACTION_PREV).addClass(this.options.classes.button+" "+this.options.classes.prevBtn),this._$endBtn=this._$wrapper.find(this.QUERY_ACTION_END).addClass(this.options.classes.button+" "+this.options.classes.endBtn),this._$result=this._$wrapper.find(this.QUERY_RESULT).addClass(this.options.classes.result),this._$result.hide()},_mapQuestions:function(){var s=this._$questions.find(this.QUERY_OPTION).find(":checkbox");s.length>0?(s.attr("type","checkbox"),this.options.multichoice=!0,this.element.addClass(this.options.classes.multichoice)):s.attr("type","radio");for(var i=this._$questions,e=[],n={},o=0,a=0,r=i.length;a<r;a++){var h=t(i[a]),d=this._mapQuestion(h);e.push(d),n[d.id]=a,o+=d.pointsForSuccess}this._questions=e,this._questionsMap=n,this._maxScore=o,this._setOption("maxScore",o)},_mapQuestion:function(s){var i,e=s.find(this.QUERY_OPTIONS),n=e.find(this.QUERY_OPTION),o=n.first().find("input").attr("name"),a=s.data(this.ATTR_POINTS_FOR_SUCCESS),r=s.data(this.ATTR_POINTS_FOR_FAIL),h=this._mapOptions(n),d=h.arr,u=h.map,l=s.find(this.QUERY_FEEDBACK).not(this.QUERY_OPTION+" "+this.QUERY_FEEDBACK);l.hide(),s.removeAttr(this.ATTR_POINTS_FOR_FAIL),s.removeAttr(this.ATTR_POINTS_FOR_SUCCESS),s.uniqueId(),i=s.attr("id"),o=void 0!=o?o:i,n.find("input").attr("name",o);for(var c={id:i,$element:s,$optionsWrapper:e,$options:n,options:d,optionsMap:u,pointsForSuccess:void 0!=a?a:this.options.pointsForSuccess,pointsForFail:void 0!=r?r:this.options.pointsForFail},_=0,p=l;_<p.length;_++){var f=p[_],E=t(f);switch(E.attr(this.ATTR_FEEDBACK)){case this.FEEDBACK_TYPES.ok:c.$feedbackOk=E;break;case this.FEEDBACK_TYPES.ko:c.$feedbackKo=E;break;default:c.$feedback=E}}return c.$feedbackOk=c.$feedbackOk||c.$feedback||t(null),c.$feedbackKo=c.$feedbackKo||c.$feedback||t(null),c},_mapOptions:function(s){for(var i=[],e={},n=0,o=s.length;n<o;n++){var a=t(s[n]),r=this._mapOption(a);i.push(r),e[r.id]=n}return{arr:i,map:e}},_mapOption:function(s){var i,e=!!s.data(this.IS_CORRECT),n=s.find(this.QUERY_FEEDBACK);s.removeAttr(this.ATTR_IS_CORRECT),s.uniqueId(),i=s.attr("id");for(var o={id:i,$element:s,isCorrect:e},a=0,r=n;a<r.length;a++){var h=r[a],d=t(h);switch(d.attr(this.ATTR_FEEDBACK)){case this.FEEDBACK_TYPES.ok:o.$feedbackOk=d;break;case this.FEEDBACK_TYPES.ko:o.$feedbackKo=d;break;default:o.$feedback=d}}return o.$feedbackOk=o.$feedbackOk||o.$feedback||t(null),o.$feedbackKo=o.$feedbackKo||o.$feedback||t(null),n.hide(),o},_assignEvents:function(){this._$startBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onStartButtonClick),this._$endBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onEndButtonClick),this._$nextBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onNextButtonClick),this._$prevBtn.off(this.NAMESPACE).on("click."+this.NAMESPACE,{instance:this},this._onPrevButtonClick),this._$questions.off(this.NAMESPACE).on("change."+this.NAMESPACE,{instance:this},this._onOptionChange)},_onStartButtonClick:function(t){t.preventDefault(),t.data.instance.start()},_onEndButtonClick:function(t){t.preventDefault(),t.data.instance.end()},_onNextButtonClick:function(t){t.preventDefault(),t.data.instance.next()},_onPrevButtonClick:function(t){t.preventDefault(),t.data.instance.prev()},_calificate:function(){var t,s=0,i=this._maxScore,e=(this._runtime,this._questions),n=0,o=0;if(1!=this.options.multichoice){var a=this._calificateSingleChoice();n=a.nSuccess,o=a.nFails,s=a.score}else{var a=this._calificateMultiChoice();n=a.nSuccess,o=a.nFails,s=a.score}return t={maxScore:i,score:s,percentage:100*s/i,questionsSuccess:n,questionsFail:o,questionsNotAttempted:e.length-(n+o)},t.success=t.percentage>=this.options.cutOffMark,t},_calificateSingleChoice:function(){for(var t=0,s=this._runtime,i=this._questions,e=0,n=0,o=0,a=i.length;o<a;o++){var r=i[o],h=(s[r.id],this._calificateSingleChoiceQuestion(r.id));void 0!=h&&(h?(t+=r.pointsForSuccess,e++):(n++,t>=r.pointsForFail&&(t-=r.pointsForFail)))}return{nSuccess:e,nFails:n,score:t}},_calificateSingleChoiceQuestion:function(t){var s,i=this.getQuestionById(t);if(i){var e=this._runtime[i.id];if(e&&e.options.length>0){s=i.options[i.optionsMap[e.options[0]]].isCorrect,e.isCorrect=s}}return s},_calificateMultiChoiceQuestion:function(t){var s,i=this.getQuestionById(t);if(i){var e=this._runtime[i.id];if(e){for(var n=i.options,o=e.options,a=0,r=0,h=0,d=0,u=n.length;d<u;d++){var l=n[d],c=-1!=o.indexOf(l.id);l.isCorrect?(r++,a+=c?1:0):c&&(h++,d=u)}s=0==h&&a==r,e.isCorrect=s}}return s},_calificateMultiChoice:function(){for(var t=0,s=this._runtime,i=this._questions,e=0,n=0,o=0,a=i.length;o<a;o++){var r=i[o],h=(s[r.id],this._calificateMultiChoiceQuestion(r.id));void 0!=h&&(h?(e++,t+=r.pointsForSuccess):(n++,t>=r.pointsForFail&&(t-=r.pointsForFail)))}return{nSuccess:e,nFails:n,score:t}},_showOptionStatus:function(t,s){var i=this.getQuestionById(t);if(i){var e=this._runtime[i.id],n=i.options[i.optionsMap[s]];if(e&&n){-1!=e.options.indexOf(s)?n.$element.addClass(n.isCorrect?this.options.classes.questionCorrect:this.options.classes.questionIncorrect):n.$element.addClass(n.isCorrect?this.options.classes.questionIncorrect:"")}else n.$element.addClass(n.isCorrect?this.options.classes.questionIncorrect:"")}},_showQuestionStatus:function(t){var s=this.getQuestionById(t);if(s){var i=this._runtime[s.id];if(i&&void 0!=i.option){var e=s.options;i.isCorrect?s.$element.addClass(this.options.classes.questionCorrect):s.$element.addClass(this.options.classes.questionIncorrect);for(var n=0,o=e;n<o.length;n++){var a=o[n];a.isCorrect?a.$element.addClass(this.options.classes.questionCorrect):a.$element.addClass(this.options.classes.questionIncorrect)}}}},_showOptionFeedback:function(t,s){var i=this.getQuestionById(t);if(i){var e=this._runtime[i.id],n=i.options[i.optionsMap[s]];if(e&&n){-1!=e.options.indexOf(s)&&(n.isCorrect?(n.$feedbackKo.hide(),n.$feedbackOk.show()):(n.$feedbackOk.hide(),n.$feedbackKo.show()))}}},_showQuestionFeedback:function(t){var s=this.getQuestionById(t);if(s){var i=this._runtime[s.id];if(i&&void 0!=i){this.getOptionById(t,i.options[0]).isCorrect?(s.$feedbackKo.hide(),s.$feedbackOk.show()):(s.$feedbackOk.hide(),s.$feedbackKo.show())}}},_disableQuestionOptionsField:function(t){var s=this.getQuestionById(t);s&&(this.options.multichoice&&this._state==this.STATES.running?s.$element.find(":checked").attr("disabled","disabled"):s.$element.find("input").attr("disabled","disabled"))},_onOptionClick:function(s){var i=s.data.instance,e=t(this),n=e.attr("id"),o=i._runtime[n]||{};!0===i.options.immediateFeedback&&void 0!=o.option&&s.preventDefault()},_onOptionChange:function(s){var i=s.data.instance;if(1!=i.options.disabled&&i._state==i.STATES.running){var e=t(s.target).parents(i.QUERY_OPTION),n=t(this),o=n.attr("id"),a=i._runtime[o]||{},r=a.options||[],h=e.attr("id");a.options=r,i._runtime[o]=a,i.options.multichoice?(s.target.checked?(r.push(h),e.addClass(i.CLASS_SELECTED)):(i._resetOption(o,h),r.splice(r.indexOf(h),1)),i._calificateMultiChoiceQuestion(o)):(a.options.length>0&&i._resetOption(o,a.options[0]),r[0]=h,e.addClass(i.CLASS_SELECTED),i._calificateSingleChoiceQuestion(o)),1==i.options.immediateFeedback&&(1==i.options.disableOptionAfterSelect?i._disableQuestionOptionsField(o):1==i.options.disableNextUntilSuccess&&i._updateNavigationActionsStates(),i._showQuestionStatus(o),i._showOptionStatus(o,h),i._showOptionFeedback(o,h),i._showQuestionFeedback(o,h)),0!=i.options.autoGoNext&&1!=i.options.multichoice&&setTimeout(function(){i.next()},i.options.delayOnAutoNext),i.element.triggerHandler(i.ON_OPTION_CHANGE,[this,o,h])}},_resetOption:function(t,s){var i=this.getQuestionById(t);if(i){var e=i.options[i.optionsMap[s]];e&&(e.$feedbackKo.hide(),e.$feedbackOk.hide(),e.$element.removeClass(this.options.classes.selected+" "+this.options.classes.questionCorrect+" "+this.options.classes.questionIncorrect))}},_setOption:function(t,s){this._super(t,s),"disabled"===t&&(s?this._disable():this._enable())},_hide:function(s){var i=this,e=t.Deferred(),n=this.element.triggerHandler(this.ON_QUESTION_HIDE,[this,s]);return void 0!=n&&n.hasOwnProperty("then")?n.then(function(){e.resolveWith(i)}):s.fadeOut(400,function(){e.resolveWith(i)}),e.promise()},_show:function(s){var i=this,e=t.Deferred(),n=this.element.triggerHandler(this.ON_QUESTION_SHOW,[this,s]);return void 0!=n&&n.hasOwnProperty("then")?n.then(function(){e.resolveWith(i)}):s.fadeIn(400,function(){e.resolveWith(i)}),e.promise()},_onHeaderHidden:function(t){t.resolveWith(this)},_hideHeader:function(){var s=t.Deferred(),i=this.element.triggerHandler(this.ON_HEADER_HIDE,[this,this._$header]);return void 0!=i&&i.hasOwnProperty("then")?i.then(this._onHeaderHidden.bind(this,s)):this._$header.fadeOut(400,this._onHeaderHidden.bind(this,s)),s.promise()},_showHeader:function(){var s=this,i=t.Deferred(),e=this.element.triggerHandler(this.ON_HEADER_SHOW,[this,this._$header]);return void 0!=e&&e.hasOwnProperty("then")?e.then(function(){i.resolveWith(s)}):this._$header.fadeIn(400,function(){i.resolveWith(s)}),i.promise()},_onBodyHidden:function(t){t.resolveWith(this)},_hideBody:function(){var s=t.Deferred(),i=this.element.triggerHandler(this.ON_BODY_HIDE,[this,this._$body]);return void 0!=i&&i.hasOwnProperty("then")?i.then(this._onBodyHidden.bind(this,s)):this._$body.fadeOut(400,this._onBodyHidden.bind(this,s)),s.promise()},_showBody:function(){var s=this,i=t.Deferred(),e=this.element.triggerHandler(this.ON_BODY_SHOW,[this,this._$body]);return void 0!=e&&e.hasOwnProperty("then")?e.then(function(){i.resolveWith(s)}):this._$body.fadeIn(400,function(){i.resolveWith(s)}),i.promise()},_animationStart:function(){var s=this,i=t.Deferred(),e=this;return this._hideHeader().then(function(){s._showBody().then(function(){i.resolveWith(e)})}),i.promise()},_animationStop:function(){var s=this,i=t.Deferred(),e=this;return this._hideBody().then(function(){s._showHeader().then(function(){i.resolveWith(e)})}),i.promise()},_disableEnd:function(){this._$endBtn.prop("disabled",!0),this._$endBtn.addClass(this.options.classes.disabled)},_enableEnd:function(){this._$endBtn.prop("disabled",!1),this._$endBtn.removeClass(this.options.classes.disabled)},_disablePrev:function(){this._$prevBtn.prop("disabled",!0),this._$prevBtn.addClass(this.options.classes.disabled)},_enablePrev:function(){this._$prevBtn.prop("disabled",!1),this._$prevBtn.removeClass(this.options.classes.disabled)},_disableNext:function(){this._$nextBtn.prop("disabled",!0),this._$nextBtn.addClass(this.options.classes.disabled)},_enableNext:function(){this._$nextBtn.prop("disabled",!1),this._$nextBtn.removeClass(this.options.classes.disabled)},_disableStart:function(){this._$startBtn.prop("disabled",!0),this._$startBtn.addClass(this.options.classes.disabled)},_enableStart:function(){this._$startBtn.prop("disabled",!1),this._$startBtn.removeClass(this.options.classes.disabled)},_onAnimationStartEnd:function(){this.goTo(0),this.element.trigger(this.ON_STARTED,[this])},_onAnimationEndEnd:function(){this.reset()},_onQuestionTransitionEnd:function(t,s,i){this._updateNavigationActionsStates(),i.resolveWith(this),this.element.triggerHandler(this.ON_TRANSITION_END,[this,t,s])},_updateNavigationActionsStates:function(){var t=this.getQuestionByIndex(this._currentQuestionIndex),s=this._runtime[t.id];if(0===this._currentQuestionIndex?(this._disablePrev(),this._enableNext()):this._currentQuestionIndex===this._questions.length-1?(this._disableNext(),this._enablePrev()):(this._enablePrev(),this._enableNext()),1==this.options.immediateFeedback&&1!=this.options.disableOptionAfterSelect)switch(1!=this.options.disableNextUntilSuccess||void 0!=s&&1==s.isCorrect||this._disableNext(),this.options.disableEndActionUntil){case this.DISABLE_END.beforeAnswerAll:Object.keys(this._runtime),this._questions.length;break;case this.DISABLE_END.beforeAnswerAllCorrect:var i=0,e=this._runtime;for(var n in e){e[n].isCorrect&&i++}i==this._questions.length?this._enableEnd():this._disableEnd()}},_onEndShowResult:function(t){t.data.instance.end()},getMaxPoints:function(){return this._maxScore},getId:function(){return this.element.attr("id")},next:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex+1):this.goTo(0)},prev:function(){return void 0!=this._currentQuestionIndex?this.goTo(this._currentQuestionIndex-1):this.goTo(0)},goTo:function(s){var i,e=this;if(this._state===this.STATES.running||this._state==this.STATES.review){var n=this._questions[s],o=this._currentQuestionIndex,a=this._questions[o];if(void 0!=n&&(void 0==a||a!=n)){var r=t.Deferred();i=r.promise(),this._disableNext(),this._disablePrev(),this._currentQuestionIndex=s,s==this._questions.length-1?(this.element.removeClass(this.options.classes.firstQuestion),this.element.addClass(this.options.classes.lastQuestion)):0==s?(this.element.removeClass(this.options.classes.lastQuestion),this.element.addClass(this.options.classes.firstQuestion)):(this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion)),this.element.attr(this.ATTR_CURRENT_QUESTION,s),a?this._hide(a.$element).then(function(){e._show(n.$element).then(e._onQuestionTransitionEnd.bind(e,a,n,r))}):this._show(n.$element).then(this._onQuestionTransitionEnd.bind(this,a,n,r))}}return i},getQuestions:function(){return this._questions},getQuestionByIndex:function(t){return this._questions[t]},getQuestionById:function(t){return this.getQuestionByIndex(this._questionsMap[t])},getOptions:function(t){return(this.getQuestionById(t)||{}).options},getOptionByIndex:function(t,s){var i,e=this.getOptions(t);return e&&(i=e[s]),i},getOptionById:function(t,s){var i,e=this.getQuestionById(t);return e&&(i=e.options[e.optionsMap[s]]),i},update:function(){},redrawProperties:function(){this._renderOptions()},reset:function(){this._runtime={},this.element.removeAttr(this.ATTR_CURRENT_QUESTION),this.element.removeClass(this.options.classes.firstQuestion),this.element.removeClass(this.options.classes.lastQuestion),this._$questions.hide(),this._$questions.first().show(),this._$questions.find("input").prop("checked",!1).removeAttr("disabled"),this.element.find(this.QUERY_FEEDBACK).hide(),this.element.find("."+this.options.classes.questionCorrect).removeClass(this.options.classes.questionCorrect),this.element.find("."+this.options.classes.questionIncorrect).removeClass(this.options.classes.questionIncorrect),this.element.find("."+this.options.classes.selected).removeClass(this.options.classes.selected)},start:function(){1!=this.options.disabled&&this._state===this.STATES.off&&(this._changeState(this.STATES.running),this.element.trigger(this.ON_START,[this]),this._runtime={},this._animationStart().then(this._onAnimationStartEnd))},showResult:function(t){return!!(t&&this.options.showResult&&this._$result)&&(this._changeState(this.STATES.result),this._renderVar(this.QUERY_RENDER_RESULT,"jqQuizResultItem",t,this._$result),this._$result.dialog(this.options.dialog).one("dialogclose",{instance:this},this._onEndShowResult),!0)},showCorrection:function(){if(this.options.showCorrection){for(var t=this._questions,s=0,i=t.length;s<i;s++){for(var e=t[s],n=e.options,o=0,a=n.length;o<a;o++){var r=n[o];this._showOptionStatus(e.id,r.id)}this._disableQuestionOptionsField(e.id)}return this._changeState(this.STATES.review),this.goTo(0),!0}return!1},_disableAllQuestions:function(){for(var t=this._questions,s=0,i=t.length;s<i;s++){var e=t[s];this._disableQuestionOptionsField(e.id)}},end:function(){if(this._state===this.STATES.running){var t=this._calificate();return this.lastCalification=t,this._disableAllQuestions(),this.showResult(t)||this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd),this.element.trigger(this.ON_END,[this,t])),t}return this._state==this.STATES.result?(this.showCorrection()||(this._changeState(this.STATES.off),this._animationStop().then(this._onAnimationEndEnd),this.element.trigger(this.ON_END,[this,this.lastCalification])),this.lastCalification):this._state==this.STATES.review?(this._changeState(this.STATES.off),this.element.trigger(this.ON_END,[this,this.lastCalification]),this._animationStop().then(this._onAnimationEndEnd),this.lastCalification):void 0},_changeState:function(t){switch(t){case this.STATES.review:this._state=t,this.element.removeClass(this.options.classes.stateRunning+" "+this.options.classes.stateResult),this.element.addClass(this.options.classes.stateReview);break;case this.STATES.running:this._state=t,this.element.removeClass(this.options.classes.stateReview+" "+this.options.classes.stateResult),this.element.addClass(this.options.classes.stateRunning);break;case this.STATES.result:this._state=t,this.element.removeClass(this.options.classes.stateReview+" "+this.options.classes.stateRunning),this.element.addClass(this.options.classes.stateResult);break;case this.STATES.off:this.element.removeClass(this.options.classes.stateResult+" "+this.options.classes.stateReview+" "+this.options.classes.stateRunning),this._state=t}},_disable:function(){this._disableStart()},_enable:function(){this._enableStart()},disable:function(){this._super(),this._disable()},enable:function(){this._super(),this._enable()},destroy:function(){this._$wrapper.removeClass(this.options.classes.wrapper),this._$header.removeClass(this.options.classes.header),this._$body.removeClass(this.options.classes.body),this._$body.show(),this._$properties.removeClass(this.options.classes.properties),this._$questionsWrapper.removeClass(this.options.classes.questions),this._$questions.removeClass(this.options.classes.question),this._$questions.show(),this._$startBtn.removeClass(this.options.classes.button+" "+this.options.classes.startBtn),this._$nextBtn.removeClass(this.options.classes.button+" "+this.options.classes.nextBtn),this._$prevBtn.removeClass(this.options.classes.button+" "+this.options.classes.prevBtn),this._$endBtn.removeClass(this.options.classes.button+" "+this.options.classes.endBtn),this._$result.removeClass(this.options.classes.result),this._$result.data("uiDialog")&&this._$result.dialog("destroy")}}),t.ui.jqQuiz});